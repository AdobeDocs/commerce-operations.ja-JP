---
title: Magento Open Source 2.4.2 リリースノート
description: 2.4.2 Magento Open Sourceリリースの新機能、機能強化、バグ修正および既知の問題について説明します。
recommendations: noCatalog
exl-id: 01e90bcb-d43c-4daa-9669-44e3370102af
source-git-commit: 95ea96a566b0579a22b2ba738bd4a4bceef8cd9c
workflow-type: tm+mt
source-wordcount: '12958'
ht-degree: 0%

---

# Magento Open Source 2.4.2 リリースノート

Magento Open Source 2.4.2 では、パフォーマンスとセキュリティの強化に加えて、プラットフォームが大幅に改善されました。 セキュリティの強化には、すべての cookie に対する `SameSite` 属性のサポートの拡張が含まれます。 Elasticsearch 7.9.x と Redis 6.x がサポートされるようになりました。

このリリースには、コアコードに対する 280 を超える新しい修正と、35 を超えるセキュリティ機能強化が含まれています。 コミュニティメンバーによる約 290 件の GitHub 問題の解決が含まれています。 これらのコミュニティの貢献度は、コアコードの小規模なクリーンアップから、GraphQLでの大幅な機能強化まで多岐にわたります。

2.4.1 で特定された既知の問題はすべて、このリリースで修正されました。

{{bics}}

## 配送業者として DHL を引き続き提供するには、`AC-3022.patch` を適用してください

DHL ではスキーマバージョン 6.2 を導入しており、近い将来、スキーマバージョン 6.0 を廃止する予定です。 DHL 統合をサポートするAdobe Commerce 2.4.4 以前のバージョンは、バージョン 6.0 のみをサポートしています。これらのリリースをデプロイするマーチャントは、DHL を配送業者として引き続き提供するために、できるだけ早い時期に `AC-3022.patch` を適用する必要があります。 パッチのダウンロードとインストールについては、ナレッジベースの記事 [DHL を引き続き配送業者として提供するためのパッチを適用する ](https://support.magento.com/hc/en-us/articles/7707818131597-Apply-a-patch-to-continue-offering-DHL-as-shipping-carrier) を参照してください。

## セキュリティパッチを利用できます

マーチャントは、完全な四半期リリースが提供する何百もの機能修正や機能強化（たとえば 2.4.1-p1）を適用することなく、時間に依存するセキュリティ修正をインストールできるようになりました。 パッチ 2.4.0.12 （Composer パッケージ 2.4.1-p1）は、以前の四半期リリース 2.4.1 で特定された脆弱性の修正を提供するセキュリティ パッチです。2.4.1 リリースに適用されたすべてのホットフィックスが、このセキュリティパッチに含まれています。 （*ホットフィックス* は、特定の問題やバグに対処するリリースバージョンの修正を提供します。）

セキュリティパッチの一般的な情報については、[ 新しいセキュリティパッチリリースの概要 ](https://community.magento.com/t5/Magento-DevBlog/Introducing-the-New-Security-Patch-Release/ba-p/141287) を参照してください。 セキュリティパッチ（パッチ 2.4.1-p1 を含む）のダウンロードと適用の手順については、[ オンプレミスでのクイックスタートのインストール ](../../../installation/composer.md) を参照してください。 セキュリティパッチには、セキュリティバグ修正のみが含まれ、完全なパッチに含まれる追加のセキュリティ機能強化は含まれません。

## その他のリリース情報

これらの機能のコードは四半期ごとのリリースにバンドルされていますが、これらのプロジェクトの一部（例：Progressive Web Application（PWA） Studio）も個別にリリースされています。 これらのプロジェクトのバグ修正は、各プロジェクトのドキュメントで利用できる別のプロジェクト固有のリリース情報に記載されています。

## ハイライト

このリリースのハイライトは次のとおりです。

### セキュリティの大幅な強化

このリリースには、35 を超えるセキュリティ修正と platform セキュリティの改善が含まれています。 すべてのセキュリティ修正は 2.4.1-p1 および 2.3.6-p1 に移植されています。

#### リモートコード実行（RCE）およびクロスサイトスクリプティング（XSS）の脆弱性を閉じるのに役立つ 35 を超えるセキュリティ強化

これらの問題に関連する確認された攻撃は、今日まで行われていません。 ただし、特定の脆弱性が悪用されて、顧客情報にアクセスしたり、管理者のセッションを引き継いだりする可能性があります。 これらの問題のほとんどは、攻撃者が最初に管理者へのアクセス権を取得する必要があります。 そのため、IP許可リストに加える、[ 二要素認証 ](https://developer.adobe.com/commerce/testing/functional-testing-framework/two-factor-authentication/)、VPN の使用、`/admin` ではなく一意の場所の使用、適切なパスワードハイジーンなど、管理者を守るために必要なすべての手順を実行してください。 修正された問題の詳細については、[Adobe セキュリティ速報 ](https://helpx.adobe.com/jp/security/products/magento/apsb21-08.html) を参照してください。

#### その他のセキュリティ機能強化

このリリースのセキュリティの改善点は次のとおりです。

* すべてのコア cookie で `SameSite` 属性がサポートされるようになりました。

* ユーザーがこれらのフィールドに値を保存しようとすると、製品およびカテゴリの説明フィールドに、悪意のあるコンテンツを特定するメッセージが表示されるようになりました。

* 悪意のあるアップロードを防ぐために、コンポーネント間のファイルシステム操作が標準化および強化されています。

* コアコンテンツセキュリティポリシー（CSP）の違反が修正されました。

{{cve-notice}}

### インフラストラクチャの改善

このリリースには、フレームワークと次の機能領域の品質を向上させるコア品質の機能強化が含まれています：顧客アカウント、カタログ、CMS、OMS、インポート/エクスポート、プロモーションとターゲティング、買い物かごとチェックアウト。

### プラットフォームの機能強化

* [**Elasticsearch 7.9.x がサポートされるようになりました**](../../../installation/system-requirements.md)。 Elasticsearch 7.9.x を実行することをお勧めしますが、Elasticsearch 2.4.x はバージョン 7.4.x との互換性を維持します。<!-- MC-36867-->

* 2.4.2 は、[ ワニス 6.4](../../../installation/system-requirements.md) でテストされています。 バージョン 2.4.x は、Varnish 6.x との互換性を維持します。

* [**Redis 6.x がサポートされるようになりました**](../../../installation/system-requirements.md)。 バージョン 2.4.x は Redis 5.x と互換性があります。<!-- MC-34853-->

* 2.4.2 は、**Composer 2.x** と互換性を持つようになりました。 マーチャントは Composer 2.x に移行することをお勧めします。このリリースは Composer 1.x を使用してインストールできますが、Composer 1.x は間もなく提供終了となります。 Composer 2.x の機能の概要については、[Composer 2.0 が利用可能になりました！](https://blog.packagist.com/composer-2-0-is-now-available/) を参照してください。

このリリースでは、分割データベースを使用するようにインストールを設定する機能は廃止されました。 現在、分割データベースを使用しているマーチャントは、単一データベースに戻す、単一データベースに移行する、または別の方法を使用する計画を開始する必要があります。 この問題の概要については、[Magento Open Sourceでの分割データベース機能の廃止 ](https://community.magento.com/t5/Magento-DevBlog/Deprecation-of-Split-Database-in-Magento-Commerce/ba-p/465187)DevBlog の投稿を参照してください。  移行手順については、[ 分割されたデータベースから単一のデータベースへの復帰 ](../../../configuration/storage/revert-split-database.md) を参照してください。

### パフォーマンスの強化

このリリースには、大規模なカタログを含むデプロイメントの API パフォーマンスと管理者の応答時間を向上させるコード機能強化が含まれています。 複数のスケーラビリティの強化により、2.4.2 では、以前のリリースの最大 20 倍も大きい複雑なカタログをネイティブにサポートできます。

### Adobe Stockの統合

このリリースにはAdobe Stock Integration v2.1.1 が含まれています。

### GraphQL

このリリースでは、次の機能に対するGraphQLのサポートが追加されました。

* [ 比較リスト ](https://developer.adobe.com/commerce/webapi/graphql/schema/products/queries/compare-list/) のサポートを追加しました。 買い物客は、比較リストを [ 作成 ](https://developer.adobe.com/commerce/webapi/graphql/schema/products/mutations/create-compare-list/) および [ 削除 ](https://developer.adobe.com/commerce/webapi/graphql/schema/products/mutations/delete-compare-list/) したり、比較リストに項目を [ 追加 ](https://developer.adobe.com/commerce/webapi/graphql/schema/products/mutations/add-products-to-compare-list/) および [ 削除 ](https://developer.adobe.com/commerce/webapi/graphql/schema/products/mutations/remove-from-compare-list/) したりできます。 さらに、ゲストとして比較リストを作成した買い物客は、顧客としてログインし、比較リストを [ 保持 ](https://developer.adobe.com/commerce/webapi/graphql/schema/customer/mutations/assign-compare-list/) できます。

* リモート購入の支援をサポートするために、[`generateCustomerTokenAsAdmin`](https://developer.adobe.com/commerce/webapi/graphql/schema/customer/mutations/generate-token-as-admin/) のミューテーションを追加し、`Customer` オブジェクトを更新しました。

* 言語、買い物かご、通貨の変更などのタスクをサポートするために、ストア全体でローカライゼーションサポートを追加しました。<!-- MC-37801-->

* GraphQLでの和集合のサポートを追加しました。 [GitHub-29425](https://github.com/magento/magento2/issues/29425) <!-- ENGCOM-8291 -->

* GraphQL スキーマが強化され、多くのバリアントを含む設定可能な商品の商品データ取得を最適化しました。<!-- MC-36138-->

* 整数タイプのオブジェクト ID は、タイプ ID の `uid` 属性に置き換わり、非推奨になりました。<!-- MC-36346-->

* 製品がステージングされているかどうかを判断し、関連するキャンペーン情報を表示するために、[`ProductInterface`](https://developer.adobe.com/commerce/webapi/graphql/schema/products/interfaces/attributes/) と [`CategoryInterface`](https://developer.adobe.com/commerce/webapi/graphql/schema/products/interfaces/category/) に `staging` 属性を追加しました。<!-- MC-33897-->

これらの機能強化について詳しくは、[GraphQL開発者ガイド ](https://developer.adobe.com/commerce/webapi/graphql/) を参照してください。

### PWA Studio

このリリースのPWA Studioには、次のものが含まれます。

* 国際化とローカリゼーション。 Venia では、複数の言語と通貨をサポートするようになりました。

* 拡張機能を通じてコードの変更をサポートする拡張フレームワークを改善しました。

* ウィッシュリスト、保存済みの支払い、アドレス帳、注文履歴など、マイアカウント関連の機能の初期コンポーネント。

* 様々なパフォーマンスの最適化とバグ修正。

機能強化とバグ修正について詳しくは、[PWA Studioリリース ](https://github.com/magento/pwa-studio/releases) を参照してください。 PWA Studioのバージョンとその互換性のあるバージョンの一覧については、[ 互換性 ](https://developer.adobe.com/commerce/pwa-studio/integrations/adobe-commerce/version-compatibility/) を参照してください。

### メディアギャラリー

**メディアギャラリーの新しい役割リソース**。 このリリースでは、マーチャントは、管理者アクセスをメディアギャラリーのみに制限したり、これらのアクションを実行できるユーザーを制御したりできます。

* コンテンツへのメディアアセットの挿入

* アセットのアップロード

* アセットの詳細を編集

* メディアギャラリーからのアセットの削除

* フォルダー構造を管理する。

**コンテンツ内の web に最適化された画像**。 マーチャントは、高解像度の画像ではなく、コンテンツで [web に最適化された画像レンディション ](https://experienceleague.adobe.com/ja/docs/commerce-admin/content-design/wysiwyg/gallery/media-gallery-image-optimization) を使用できるようになりました。 元の画像はメディアギャラリー内で変更されずに残り、画像がコンテンツに挿入される際に画像レンディションが動的に生成されます。

### 機能テストフレームワーク（MFTF）

MFTF 3.2.1 が利用可能になりました。 このリリースでは、テストとテストスイートの生成の両方でエラー許容値が導入されています。 その他の機能強化とバグ修正については、[ 機能テストフレームワークの変更ログ ](https://github.com/magento/magento2-functional-testing-framework/blob/develop/CHANGELOG.md) を参照してください。

### ベンダーが開発した拡張機能

このリリースの機能および変更点については、以下の記事を参照してください。

* [Amazon支払 ](https://marketplace.magento.com/amzn-amazon-pay-magento-2-module.html)

* [Braintree](https://experienceleague.adobe.com/ja/docs/commerce-admin/stores-sales/payments/braintree)

* [dotdigital Engagement Cloud](https://marketplace.magento.com/dotdigital-dotdigital-magento2-os-package.html)

* [ クルナ ](https://marketplace.magento.com/klarna-m2-klarna.html)

* [ 頂点クラウド ](https://marketplace.magento.com/vertexinc-vertex-tax-module.html)

* [Yotpo 製品レビュー](../../../upgrade/modules/upgrade.md)

### AWS S3 のサポートの強化

Amazon Simple Storage Service （AWS S3）のサポートが強化され、次のサポートが含まれるようになりました。

* オブジェクトストレージと将来の拡張性

* AWS S3 での [ メディアファイルの保存 ](../../../configuration/remote-storage/remote-storage.md)

## 修正された問題

2.4.2 コアコードの何百もの問題を修正しました。

### インストール，アップグレード，デプロイメント

<!-- MC-38429-->

* このリリースでは、分割データベースを使用するようにインストールを設定する機能は廃止されました。 [Magento Open Source内の分割データベース機能の廃止 ](https://community.magento.com/t5/Magento-DevBlog/Deprecation-of-Split-Database-in-Magento-Commerce/ba-p/465187)DevBlog の投稿を参照してください。

<!-- MC-36472-->

* マーチャントは、MySQL 8.x を実行する Open Source デプロイメントをCommerce デプロイメントに正常にアップグレードできるようになりました。 以前は、アップグレード中に `row_id` が追加されたすべてのテーブルで `AUTO_INCREMENT` 値が初期値に戻った場合、アプリケーションで例外がスローされていました。

<!-- ENGCOM-7280 -->

* `bin/magento/setup:db:generate-patch` の実行時にエラーが発生した場合、パッチの作成に使用されたパスを識別するエラーメッセージが表示されるようになりました。 [GitHub-27523](https://github.com/magento/magento2/issues/27523)

<!-- ENGCOM-8029 -->

* `block_html`、`full_page`、`layout` のキャッシュは、実 `bin/magento/setup:upgrade` 行後、期待どおりに無効になりました。  [GitHub-28186](https://github.com/magento/magento2/issues/28186)

<!-- ENGCOM-8184 -->

* `bootstrap.php` で最低限必要な PHP バージョンが更新されました。 [GitHub-30004](https://github.com/magento/magento2/issues/30004)

<!-- MC-38788-->

* サンプルデータをインストールした後で `bin/magento/setup:upgrade` を実行できるようになりました。 以前は、`bin/magento/setup:upgrade` を実行しようとすると、アプリケーションに「`unable to apply data patch magento\catalogrulesampledata\setup\patch\data\installcatalogrulesampledata for module magento_catalogrulesampledata`」というエラーが表示されていました。 アプリケーションのシステム ログにも次のエラーが表示されました：`main.ERROR: Sample Data error: Unable to unserialize value. Error: Syntax error`。 [GitHub-30685](https://github.com/magento/magento2/issues/30685)

<!-- MC-36785-->

* コマンドラインからYouTube API キーを期待どおりに設定できるようになりました。 以前は、`bin/magento config:sensitive:set catalog/product_video/youtube_api_key`: `There are no sensitive configurations to fill` を実行しようとすると、アプリケーションによってこのエラーが返されていました。

<!-- ENGCOM-8163 -->

* アプリケーションは、`queue_consumer.xml` で定義された `maxMessages` の値に従うようになりました。 以前は、アプリケーションはデプロイメント設定値のみを使用していました。 [GitHub-29522](https://github.com/magento/magento2/issues/29522)

<!-- ENGCOM-8243 -->

* `bin/magento setup:config:import` を使用してストアを作成する際に、新しいストアの URL 生成が期待どおりに動作するようになりました。 以前は、実稼動環境で URL の書き換えが生成されていませんでした。 [GitHub-30025](https://github.com/magento/magento2/issues/30025)

<!-- ENGCOM-8230 -->

* Magento Open Sourceをインストールした後に `ssh` コンテナを使用して `backend-frontname` を変更しようとすると、アプリケーションがエラーをスローしなくなりました。 [GitHub-26762](https://github.com/magento/magento2/issues/26762)

<!-- ENGCOM-8230 -->

* `bin/magento setup:install` を実行して既存のデータベースに接続する場合に、この質問がアプリケーションに表示されなくなりました：`Overwrite the existing configuration for db-ssl-verify?[Y/n]`。 [GitHub-29612](https://github.com/magento/magento2/issues/29612)

### Adobe Stockの統合

<!-- ENGCOM-8020-->

* `exif_image.png` または `exif-image.jpeg` メタデータの読み取りがサポートされるようになりました。 [GitHub-1449](https://github.com/magento/adobe-stock-integration/issues/1449)

<!-- ENGCOM-8194 8094 8147-->

* メディアギャラリーのデフォルト表示ブックマークをクリックしたときに表示されるコンテンツがフィルタリングされなくなりました。 以前は、アプライアから適用されたフィルタがデフォルトビュー `url-filter` 含まれていました。 [GitHub-1813](https://github.com/magento/adobe-stock-integration/issues/1813)、[GitHub-1789](https://github.com/magento/adobe-stock-integration/issues/1789)、[GitHub-1780](https://github.com/magento/adobe-stock-integration/issues/1780)

<!-- ENGCOM-8070 -->

* ロジックがWYSIWYG OnInsert コントローラー（`Magento\Cms\Controller\Adminhtml\Wysiwyg\Images\OnInsert::execute()`）から削除され、`Model\Wysiwyg\Images\PrepareImage::execute()` モデルに追加されました。 [GitHub-1504](https://github.com/magento/adobe-stock-integration/issues/1504)

<!-- ENGCOM-8081 -->

* エリア エミュレーションが `media-content:sync` コマンドから削除されました（`\Magento\MediaContentSynchronization\Console\Command\Synchronize::execute`）。 [GitHub-1784](https://github.com/magento/adobe-stock-integration/issues/1784)

### Analytics

<!-- MC-37137-->

* 高度なレポートが、同じドメイン内の複数の環境で期待どおりに機能するようになりました。 以前は、高度なレポートで生成された CSV ファイルは、CSV 標準 RFC4180 で必要とされる別の二重引用符ではなく、バックスラッシュで二重引用符がエスケープされているので失敗しました。

<!-- MC-35996-->

* デフォルトまたはデフォルト以外のポートを使用して `env.php` で MySQL に接続する場合、`analytics_collect_data` ジョブは正常に実行されるようになりました。 以前は、デフォルト以外のポートを使用した場合、`analytics_collect_data` がエラーをスローしていました。

<!-- MC-35407-->

* `analytics_collect_data` で生成される CSV ファイルが適切にエスケープされるようになりました。 以前は、これらのファイルは正しいエスケープで生成されていなかったので、在庫レポートを生成できませんでした。

### Braintree

* 買い物客はApple Pay を使用して、バーチャル商品を正常に注文できるようになりました。 以前は、アプリケーションは次のエラーをスローしていました：`There are no shipping methods available for you right now. Please try again or use an alternative payment method`。

* デフォルトの PayPal Express Checkout の支払い方法は、Braintreeクレジットカードの支払い方法で期待どおりに機能するようになりました。 以前は、Braintreeクレジットカードによる支払い方法が有効になっている場合は、「**PayPal**」ボタンが表示されていませんでした。

### バンドル製品

<!-- MC-34063-->

* 固定価格のバンドル製品の子品目の価格が見積もりで設定されなくなりました。

<!-- MC-38050-->

* バンドル製品に在庫切れ製品が含まれる場合、価格の並べ替えが期待どおりに機能するようになりました。 以前は、価格を降順で並べ替えても、価格が下がる順に製品が表示されていませんでした。

<!-- MC-38576-->

* 多くのオプションが存在する場合、アプリケーションはバンドル製品オプションにデフォルトの数量 1 を自動的に適用するようになりました。 以前は、マーチャントは、各オプションにデフォルトの数量を手動で割り当てる必要がありました。

<!-- ENGCOM-8159 -->

* 注文請求書の作成ページに、バンドル製品の子製品が期待どおりに表示されるようになりました。 [GitHub-27350](https://github.com/magento/magento2/issues/27350)

<!-- MC-38460 -->

* バンドル製品の一部であるシンプルな製品をカスタム価格で再注文すると、アプリケーションによって正しい製品価格が割り当てられるようになりました。 以前は、バンドル製品にカスタム価格を設定すると、並べ替え時に添付されたシンプルな製品の価格が誤って表示されていました。 [GitHub-30343](https://github.com/magento/magento2/issues/30343)

<!-- MC-30348 -->

* バンドル商品を含む注文を出荷するためにPOST`/V1/order/{orderId}/ship` を呼び出すと、注文が期待どおりに完了したとマークされるようになりました。 以前は、アプリケーションで「`You can't create a shipment without products`」というエラーメッセージが表示されていました。 [GitHub-9762](https://github.com/magento/magento2/issues/9762)

### 買い物かごとチェックアウト

<!-- MC-34264-->

* チェックアウトワークフローの出荷手順にカスタム住所属性が存在する場合、出荷方法見積もりが期待どおりに機能するようになりました。 以前は、アプリケーションで「`{"message":"Error occurred during \"custom_attributes\" processing. A custom attribute is specified with a missing attribute code. Verify the code and try again."}`」というエラーメッセージが表示されていました [GitHub-27505](https://github.com/magento/magento2/issues/27505)

<!-- MC-35783-->

* 買い物客が買い物かごにある唯一の項目を削除すると、アプリケーションは、ミニ買い物かごに `You have no items in your shopping cart` メッセージを期待どおりに表示するようになりました。 以前は、買い物客が 1 つの項目を削除した際に `checkout/cart/removeFailed` の買い物かごデータが更新されず、アプリケーションに「`1 product requires your attention`」というメッセージが表示されていました。

<!-- MC-36088-->

* 適用外の出荷方法に対する受注の出荷原価が表示されなくなります。 以前は、アプリケーションは、チェックアウトワークフローで適用されない発送方法の価格が 0 と表示されていました。

<!-- MC-36598-->

* チェックアウトワークフローの **請求先と配送先住所が同じ** チェックボックスの選択が解除されている場合、顧客のデフォルトの請求先住所が選択されるようになりました。

<!-- MC-37351-->

* 買い物客が別のドメインのストアから別のストアに切り替えても、買い物かごの中身が失われなくなりました。

<!-- MC-38000-->

* 買い物客は、複数の配送方法を使用する場合、「複数のアドレスを使用してチェックアウト」を使用して、注文を正常に完了できるようになりました。 以前は、アプリケーションに「`There has been an error processing your request`」というエラーが表示されていました。 [GitHub-30197](https://github.com/magento/magento2/issues/30197)

<!-- MC-38048-->

* 買い物客が買い物かごからストア表示を変更すると、チェックアウトワークフローの出荷ページに、正しいデフォルトの国が表示されるようになりました。

<!-- MC-38309-->

* ゲストの買い物客がログインしたときにログアウト後のパスワードがリセットされた後に、顧客セッションをクリーンアップする際に、アプリケーションは現在のセッションを除外するようになりました。 以前は、買い物客がパスワードをリセットすると、アプリケーションは買い物かごを空にしていました。

<!-- MC-36884-->

* 買い物客が買い物かごのストア表示を変更すると、アプリケーションには、ストア表示の正しいデフォルトの国が表示されるようになりました。 以前は、買い物かごでストア表示を変更すると、デフォルトの国が正しく表示されていませんでした。

<!-- MC-38746-->

* 買い物かごの `/rest/V1/guest-carts/cart_id/totals-information` エンドポイントへの冗長な呼び出しが削除され、買い物かごのパフォーマンスが向上しました。 以前は、買い物客が買い物かごに製品を追加し、その後その買い物かごを表示すると、アプリケーションは `collectAddressTotals` メソッドを複数回呼び出していました。

<!-- MC-38833-->

* 「**国でオプションの場合は状態を選択することを許可** 設定が無効になっている場合、チェックアウトワークフローで国の **地域** フィールドが表示されなくなりました。 [GitHub-30747](https://github.com/magento/magento2/issues/30747)

<!-- MC-38813-->

* 注文が管理者から再注文されると、ストアフロントのチェックアウトワークフローで配送先住所が繰り返されなくなりました。

<!-- MC-38814-->

* `AdminMediaGalleryInsertLargeImageFileSizeTest` の設計の問題を修正しました。

<!-- MC-37321-->

* ゲストの `quote` テーブルのすべての新しいレコードに、`customer_is_guest field` で 1 の値が割り当てられました。 以前は、買い物かごに製品を追加した新規ゲストごとに、`quote.customer_is_guest` フィールドに 0 がレコードに割り当てられていました。

<!-- ENGCOM-8091 -->

* チェックアウトワークフローの「確認と支払い」セクションの **送信** ボタンが `<form id="purchaseorder-form"...></form>` 内に移動され、JavaScriptを変更せずに暗黙的にフォームを送信できるようになりました。 [GitHub-27925](https://github.com/magento/magento2/issues/27925)

<!-- ENGCOM-8428 -->

* **国のオプションの場合は状態の選択を許可** 設定が無効になっている場合に、チェックアウトワークフローに **地域** フィールドが表示されなくなりました。 [GitHub-30747](https://github.com/magento/magento2/issues/30747)

<!-- ENGCOM-8442 -->

* 複数のアドレスをチェックアウト中に買い物客が **買い物かごを更新** をクリックしても、アプリケーションによって買い物かごの項目の小計が正しく更新されるようになりました。 [GitHub-30408](https://github.com/magento/magento2/issues/30408)

<!-- ENGCOM-8283 -->

* 現在インストールされていない支払い方法にノードが存在する場合 `config.xml` アプリケーションが例外をスローしなくなりました。 以前は、チェックアウト中にアプリケーションが例外をスローしていました。 [GitHub-29555](https://github.com/magento/magento2/issues/29555)

<!-- ENGCOM-8215 -->

* 特殊文字を含む製品名がミニカートに正しくレンダリングされるようになりました。 [GitHub-29075](https://github.com/magento/magento2/issues/29075)

<!-- ENGCOM-8308 -->

* アプリケーションで、表レートに対する正しい割引パッケージが設定されるようになりました。 以前は、アプリケーションは、計算済テーブル・レートの場合にカートに割引を設定するカート・ルールを適用していませんでした。 [GitHub-30169](https://github.com/magento/magento2/issues/30169)

### 買い物かご価格ルール

* 税金を組み込まずに注文の小計を計算する際に、買い物かご価格ルールが期待どおりに適用されるようになりました。 新しい「`Subtotal (Incl. Tax)`」オプションが買い物かご価格ルール条件として追加されました。

<!-- MC-37884-->

* **買い物かご全体に対する固定金額割引** アクションを使用した場合、GraphQLを使用してクーポンに価格ルールを適用すると、期待どおりに機能するようになりました。

### カタログ

<!-- MC-34100-->

* アプリケーションは、ストアフロントで再有効化されたすべての製品を期待どおりに表示するようになりました。 以前は、製品を無効化してから再度有効にすると、製品を再度有効にした後にページキャッシュが無効化されなかったので、Varnish ページキャッシュがクリアされるか、ストアが再インデックス化されるまで、アプリケーションに製品が表示されませんでした。

<!-- MC-37745-->

* 大きなカタログの部分的なインデックス再作成が期待どおりに動作するようになりました。 以前は、`catalogsearch_fulltext` 部分インデクサーを使用したインデックス再作成中に、製品がストアフロントのカテゴリページからランダムに表示されなくなりました。

<!-- MC-35123-->

* 買い物客は、カスタマイズ可能なオプションを使用して、商品の請求済み注文を期待どおりに並べ替えることができるようになりました。 以前は、買い物客が並べ替えようとした際に、アプリケーションがこのエラーをスローしていました。`{"0":"The product's required option(s) weren't entered. Make sure the options are entered and try again`

<!-- MC-35212-->

* これで、カテゴリデザインページの **レイアウト** 設定が正常に **レイアウトの更新なし** に設定されました。 以前は、**レイアウトの更新なし** の値を割り当てたときに、アプリケーションが **Category - FullWidth** に戻っていました。

<!-- MC-35490-->

* ストアフロントの商品の並べ替え順に関する問題を解決しました。 以前は、アプリケーションで製品の価格のインデックスを作成する際に、`catalog_product_index_price` テーブルで設定可能な製品の `min_price` と `max_price` を 0 に設定することがありました。これが、ストアフロントの価格の並べ替え順に影響を与えました。

<!-- MC-35608-->

* アプリケーションは、`Product Type` というラベルが付いた属性を正常に更新するようになりました。 以前は、コード内で `product_type` 属性が予約されているので、`Product Type` 属性を更新しようとすると、アプリケーションにこのメッセージが表示されていました。`An attribute with the same code (product_type) already exists.`

<!-- MC-36214-->

* 製品を保存しても、製品詳細ページの「画像とビデオ」セクションでアップロードされたビデオの位置が変更されなくなりました。 以前は、新しい画像の位置にインデックス値（リスト内の位置）が割り当てられ、既存の画像の位置がインデックス値と揃っていなかった場合は、新しい画像がリスト内で誤って配置されていました。

<!-- MC-36548-->

* この **買い物かごに追加** 機能は、「**買い物かごに追加** ボタンをクリックできる場合は常に期待どおりに動作するようになりました。 以前は、製品ページの読み込みを待っている間にこのボタンを複数回クリックした場合、アプリケーションは次のエラーをスローしていました。`Invalid Form Key. Please refresh the page`

<!-- MC-37006 36835-->

* マーチャントが無効な商品をカテゴリに追加またはカテゴリから削除しても、アプリケーションがカテゴリキャッシュをフラッシュしなくなりました。 以前は、製品ステータスに関わらず、アプリケーションは関連カテゴリのキャッシュをフラッシュしました。 また、カテゴリが保存されたときにカテゴリの割り当ても解除され、カテゴリキャッシュのフラッシュが発生していました。

<!-- MC-37347-->

* **すべてのストア表示** 範囲内のカタログ製品フィルタリングが正しく機能するようになりました。 以前は、ステータスが `Enabled` または `Disabled` の製品は、有効な製品または無効な製品のみをフィルタリングする際にグリッドに表示されていました。

<!-- MC-38038-->

* 部分的なインデックス再作成によって、製品が欠落したりカテゴリが空になったりすることがなくなりました。

<!-- MC-38315-->

* **JavaScript カレンダーを使用** が有効になっている場合（**ストア**/**設定**/**カタログ**/**日時カスタムオプション**）に、並べ替えが期待どおりに動作するようになりました。 以前は、この設定が有効になっている場合、以前に注文した注文を管理者：`Please specify date required option(s)` から再度注文しようとすると、アプリケーションにこのエラーが表示されていました。

<!-- MC-38719-->

* 階層価格作成時に、マルチサイト展開で正しい通貨が表示されるようになりました。

<!-- MC-38914-->

* 製品画像のカスタム属性が正しくエスケープされるようになりました。 `data-src` 属性の値は、期待どおり `src` 属性と同じです。 以前は、URL の特殊文字はエスケープされていました。

<!-- MC-37665-->

* REST API を使用してカテゴリを更新しても、「カテゴリを有効にする」、「メニューに含める」、および「URL キー」属性の **デフォルト値を使用** 設定が無効にならなくなりました。

<!-- MC-35363-->

* カテゴリを保存すると、このカテゴリに関連するブロックキャッシュのみがフラッシュされるようになりました。 以前は、アプリケーションは、すべてのカテゴリブロックのキャッシュをフラッシュしました。

<!-- MC-30626-->

* パーセント価格のカスタムオプションの価格が、マルチストアデプロイメントで、アクティブストアの基本通貨に期待どおりに変換されるようになりました。 以前は、パーセント価格のカスタムオプションの価格が誤って変換されていました。 [GitHub-26432](https://github.com/magento/magento2/issues/26432)

<!-- MC-38890-->

* アプリは正常に画像を再作成し、マーチャントがPOST`rest/all/V1/products` を使用してメディアギャラリーデータを送信するたびに、これらの画像が管理者に期待どおりに表示されるようになりました。 以前は、マーチャントがPOST経由で Media Gallery データを送信した際に、アプリ `rest/all/V1/products` ーションが画像を再作成したものの、`pub/media` に画像が削除されたにもかかわらず、メディアにまだ画像のレコードが含まれているのであれば、アプリケーションは画像を削除しました。 その結果、更新プロセス中に画像が作成および削除されたので、マーチャントには Admin のプレースホルダーのみが表示されました。

<!-- MC-36903-->

* Web サイトから項目の割り当てを解除した際に、レコードが期待どおりに削除されるようになりました。 以前は、POST `rest/all/V1/products` の実行時に画像が複製されていました。

<!-- MC-38413-->

* `/V1/categories/{categoryId}/products` 呼び出しで、親カテゴリに属するすべての製品のリストが期待どおりに返されるようになりました。 以前は、製品が親カテゴリの複数のサブカテゴリに属していた場合、アプリケーションは次のタイプのエラーをスローしていました。`Internal Error. Details are available in the application log file. Report ID: webapi-5f8579e37db54`  [GitHub-30461](https://github.com/magento/magento2/issues/30461)

<!-- MC-32996-->

* `/V1/products/attributes/:attributeCode/options` REST エンドポイントで、既存の属性オプションの更新がサポートされるようになりました。

<!-- MC-30626 ENGCOM-8475-->

* パーセント価格のカスタムオプションの価格が、マルチストアデプロイメントで、アクティブストアの基本通貨に期待どおりに変換されるようになりました。 以前は、パーセント価格のカスタムオプションの価格が誤って変換されていました。 [GitHub-26432](https://github.com/magento/magento2/issues/26432)

<!-- ENGCOM-8395 -->

* マーチャントは、製品の作成中に新しい属性を正常に保存できるようになりました。 以前は、アプリケーションは属性を保存せず、属性を保存しようとすると、マーチャントをストアビューホームページにリダイレクトしていました。 [GitHub-30362](https://github.com/magento/magento2/issues/30362)

<!-- ENGCOM-7997 -->

* **Sales**/**Orders** ページと **Catalog**/**Products** ページの商品グリッドには、最近作成されたストアだけでなく、関連するすべてのストアが一覧表示されるようになりました。 [GitHub-29267](https://github.com/magento/magento2/issues/29267)

<!-- ENGCOM-6698 -->

* 製品リポジトリーで、使用可能な場合、既存の製品の属性値を保存するために `store_id` を使用するようになりました。  以前は、製品リポジトリクラスは製品ストア ID を上書きし、常にデフォルトのストア ID が割り当てられていました。 [GitHub-29933](https://github.com/magento/magento2/issues/29933)

### カタログルール

<!-- MC-35065-->

* カタログ価格ルールが、製品詳細ページのカスタムオプションで期待どおりに機能するようになりました。 以前は、そのページの製品価格には、該当するカタログ価格ルールが反映されていませんでした。 [GitHub-22856](https://github.com/magento/magento2/issues/22856)

<!-- MC-34265-->

* 製品およびカタログのキャッシュが、スケジュールに従って期限切れになりました。 以前は、`сron` が `catalogrule_apply_all` タスクを 1 日に 1 回実行し、すべてのカタログルールおよび依存インデクサーのインデックスを再作成し、すべての製品とカテゴリのキャッシュをクリアしたので、キャッシュは毎日期限切れになりました。

### Cleanup

#### 誤字と文法のクリーンアップ

<!-- ENGCOM-7967 -->

* 注文失敗ページのタイトルが正確になるように修正されました。 以前は、このページのタイトルは **We received your order!**。  [GitHub-29416](https://github.com/magento/magento2/issues/29416)

<!-- ENGCOM-8101 -->

* `app/code/Magento/Contact/view/frontend/templates/form.phtml` の不要なスペースを削除しました。 [GitHub-29779](https://github.com/magento/magento2/issues/29779)

<!-- ENGCOM-7716 -->

* `bin/magento/setup:config:set` サブコマンドのヘルプメッセージの誤字を修正しました。  [GitHub-28802](https://github.com/magento/magento2/issues/28802)

<!-- ENGCOM-8058 -->

* `framework/Registry.php` ファイルの PHPDoc の文法を修正しました。 [GitHub-29661](https://github.com/magento/magento2/issues/29661)

<!-- ENGCOM-8273 -->

* `app/code/Magento/Catalog/Helper/Product/View.php` から不要な空白を削除しました。 [GitHub-30601](https://github.com/magento/magento2/issues/30601)

<!-- ENGCOM-8181 -->

* `app/code/Magento/Ui/view/base/web/js/form/element/ui-select.js` の関数名の誤字を修正しました。 [GitHub-29987](https://github.com/magento/magento2/issues/29987)

<!-- ENGCOM-8478 -->

* ミニ買い物かごとチェックアウト注文の概要の「品目」の複数表示を修正しました。 [GitHub-29920](https://github.com/magento/magento2/issues/29920)

<!-- ENGCOM-8309 -->

* マークアップのレイヤー化されたナビゲーションフィルターのインライン要素の空白を削除しました。 [GitHub-30448](https://github.com/magento/magento2/issues/30448)

<!-- ENGCOM-8056 -->

* `rl` が `\Magento\Framework\Filter\Template\Tokenizer\Parameter` で `url` に修正されました。 [GitHub-29185](https://github.com/magento/magento2/issues/29185)

#### コードのクリーンアップ

<!-- MC-37922-->

* **システム**/**インポート** ページのデータチェックメッセージ領域から、タグ `<br>` の不要なHTMLが削除されました。

<!-- ENGCOM-8028 -->

* `ChangeQuoteControl` はリファクタリングされています。 [GitHub-29673](https://github.com/magento/magento2/issues/29673)

<!-- ENGCOM-8027 -->

* `AccessChangeQuoteControl` とその単体テストはリファクタリングされています。 [GitHub-29672](https://github.com/magento/magento2/issues/29672)

<!-- ENGCOM-8053 -->

* `app/code/Magento/Captcha/CustomerData/Captcha.php` の戻り値タイプ宣言のコードスタイルを修正しました。 [GitHub-29712](https://github.com/magento/magento2/issues/29712)

<!-- ENGCOM-8288 -->

* 新規属性ページのボタンリストの位置を修正しました。

<!-- ENGCOM-8315 -->

* フロントエンドクラスの正しいブロッククラス `viewModel`、フロントエンドクラスの参照例を追加 `\Magento\Framework\View\Element\Template` ました。 [GitHub-30450](https://github.com/magento/magento2/issues/30450)

<!-- ENGCOM-8090 -->

* 販売ルールフォームの冗長なフィールドセットが削除されました。 [GitHub-29599](https://github.com/magento/magento2/issues/29599)

<!-- ENGCOM-8448 -->

* `hierarchy/edit.phtml` テンプレートから不要なコードが削除されました。

<!-- ENGCOM-8446 -->

* `app/code/Magento/CatalogImportExport/Model/Export/Product.php` の PHPdoc コメントを修正しました。 [GitHub-30833](https://github.com/magento/magento2/issues/30833)

<!-- ENGCOM-8277 -->

* `PublisherInterface` メッセージの docblock 注釈が修正されました。 [GitHub-30190](https://github.com/magento/magento2/issues/30190)

<!-- ENGCOM-8264 -->

* `getStatusByState` メソッドの引数を修正しました。 [GitHub-30173](https://github.com/magento/magento2/issues/30173)

<!-- ENGCOM-8235 -->

* `app/code/Magento/Quote/Model/Cart/Totals/ItemConverter.php` でメソッドの説明を修正しました。 [GitHub-30125](https://github.com/magento/magento2/issues/30125)

<!-- ENGCOM-8242 -->

* 複数のファイルの同じ行にある冗長な変数割り当てを削除しました。 [GitHub-30133](https://github.com/magento/magento2/issues/30133)

<!-- ENGCOM-8263 -->

* が `EntityAbstract.php` で `@param string $attribute` を `@param AbstractAttribute|string[]|string $attribute` に変更しました。 [GitHub-30191](https://github.com/magento/magento2/issues/30191)

<!-- ENGCOM-8142 -->

* 無効なタグ（`@package` や `@subpackage` など）は、コードベース全体でドックブロックから削除されています。 [GitHub-30061](https://github.com/magento/magento2/issues/30061)

<!-- ENGCOM-8117 -->

* `AdvancedPricing` クラスの構成内の未使用のパラメーターが削除されました。 [GitHub-29531](https://github.com/magento/magento2/issues/29531)

### 設定可能な製品

<!-- MC-35016-->

* 在庫切れの設定可能な製品を価格別にフィルタリングすると、正しい価格範囲内の結果が表示されるようになりました。

<!-- MC-38930-->

* バーチャル製品のステータスが有効から無効（またはその逆）に変更されても、タイプが変更されなくなりました。 以前は、ステータスが変更されると、アプリケーションによって製品のタイプが virtual から simple に変更されていました。

<!-- MC-38197-->

* `getValue()` メソッドでは、買い物かごの更新時に致命的なエラーがトリガーされなくなりました。

<!-- MC-34444-->

* 複数の web サイトで使用できる設定可能な製品で、特定の web サイトに割り当てられていない単純な子製品が表示されなくなりました。 [GitHub-28291](https://github.com/magento/magento2/issues/28291)

<!-- ENGCOM-8202 -->

* ストアフロントの製品ページに、予期したとおりに税金なしの階層価格が表示されるようになりました。 [GitHub-12225](https://github.com/magento/magento2/issues/12225)

<!-- ENGCOM-8134 8174-->

* 設定可能な製品の MSRP 価格が、選択した通貨に正しく変換されるようになりました。 以前は、アプリケーションは誤った通貨で価格を表示し、次のエラーをスローしました：`Call to a member function setAppliedTaxes() on null`。 [GitHub-26526](https://github.com/magento/magento2/issues/26526), [GitHub-29603](https://github.com/magento/magento2/issues/29603)

<!-- ENGCOM-8234 -->

* マーチャントは、値が 0 （ゼロ）のストア固有のテキストスウォッチ属性オプションラベルを保存できるようになりました。 以前は、値 0 は、管理ラベルオプションの値に置き換えられました。 [GitHub-30073](https://github.com/magento/magento2/issues/30073)

### cron

<!-- MC-37712-->

* システム メッセージ リストに、`cron` の実行後にアプリケーションがスケジュールどおりに製品を更新した場合でも、製品の更新が正確に反映されるようになりました。

<!-- ENGCOM-8164 -->

* `schedule_id` および `status` に基づくインデックスが `cron_schedule` テーブルに追加されました。 [GitHub-29601](https://github.com/magento/magento2/issues/29601)

### カスタム顧客属性

<!-- MC-23545-->

* 作成後、「アカウント情報」ページにタイプ `file` の顧客属性が表示されるようになりました。 以前は、このタイプの新しい属性を保存しようとすると、アプリケーションに `The "newAttribute" attribute value is empty. Set the attribute and try again` と `Validation is failed` のエラーが表示されていました。

<!-- MC-23544-->

* 複数行のカスタム顧客属性値がアプリケーションに正しく表示されるようになりました。 以前は、一部のデータが表示されていませんでした。

<!-- MC-36978-->

* このアプリケーションは、アカウントの作成時に無効な生年月日を入力した場合、買い物客にアラートを表示するようになりました。 以前は、バリデーターはロケール設定を無視し、買い物客は「無効な日付」エラーで新しい顧客アカウントを作成ページにリダイレクトされていました。

<!-- MC-38846-->

* カスタムアドレス属性が、チェックアウトワークフローの支払い手順に期待どおりに含まれるようになりました。

<!-- MC-38114-->

* カスタムアドレスの複数選択属性が、ゲストのチェックアウト時および管理者とマイアカウントの注文の詳細ページで正しく表示されるようになりました。

<!-- MC-37101-->

* `Input Type` が `Text` に設定され、`Input Validation` が `Numeric Only` に設定されている場合、カスタム顧客属性の先頭の 0 を削除できるようになりました。

<!-- MC-36721-->

* アプリケーションは、カスタムの性別属性値を含む顧客データを正常に書き出すようになりました。

### 顧客

<!-- MC-35771-->

* Storefront customer account ページの「生年月日」フィールドのカレンダーウィジェットで、指定されたストアのロケールが使用されるようになりました。

<!-- MC-38498-->

* 管理者から既存の顧客の再注文をチェックアウトする際に、顧客住所の重複エントリが保存されなくなりました。

<!-- MC-37393-->

* 管理者から複数の顧客のすべてのアドレスを削除すると、顧客のアドレスリストからすべてのアドレスが削除され、デフォルトの請求先と配送先住所が削除されるようになりました。 以前は、アプリケーションは顧客住所リストから住所を削除しましたが、デフォルトの請求先住所と出荷先住所は削除しませんでした。

<!-- MC-37377-->

* 管理者がアドレスの一括削除を実行した後、「管理者の顧客アドレス」タブにアドレス数が正しく表示されるようになりました。 以前は、アプリケーションのカウントに削除されたアドレスが含まれていました。

<!-- MC-36718-->

* 顧客登録ページの **生年月日** フィールドの日時形式が修正されました。 以前は、1 桁の日付の前に先頭のゼロが欠落していました。

<!-- MC-36024-->

* 買い物客が「**アカウントの作成** ボタンをクリックする前に、「生年月日 **フィールドの日付形式の検証が機能するよ** になりました。 以前は、買い物客が無効な形式で値を入力する可能性があり、「**アカウントを作成**」ボタンをクリックすると、買い物客は無効な日付エラーで新しい顧客アカウントを作成ページにリダイレクトされていました。

<!-- MC-33867-->

* 属性に対して無効なデータが含まれる新しい顧客アカウントを管理者が保存しようとすると、アプリケーションで致命的なエラーがスローされなくなりました。

<!-- MC-36258-->

* 以前にテーマがインストールされ、デフォルトの Luma Magento Shippingが現在デプロイされているデプロイメントで、お客様が買い物かごにアクセスしようとすると、アプリケーションで 400 エラーがスローされなくなりました。 以前は、アプリケーションは、サーバーにリクエストを送信する前に、管理者でサポートされていない、以前にインストールまたは有効にしたモジュールによって作成されたセクション名を除外していませんでした。これにより、エラーが発生しました。

<!-- MC-35812-->

* **メール確認を必要とする** 設定が有効になっており、上書きされている場合、買い物客がゲストアカウントを作成すると、アプリケーションに期待どおりにメッセージが表示される `Magento\Customer\Controller\Account\CreatePost` うになりました。 以前は、アプリケーションは、このタイプのユーザー登録プロセスのカスタマイズを許可せず、この条件の下で、ユーザーの電子メール確認ステータスが完了と見なされ、新しいユーザーが自動的にログインし、エラーメッセージは表示されませんでした。

<!-- ENGCOM-8039 -->

* **顧客グループへの自動割り当てを有効にする** が有効になっているストアで、デフォルト以外の顧客グループに買い物客が注文を行った場合、アプリケーションによって買い物客が正しい顧客グループに割り当てられるようになりました。 [GitHub-26976](https://github.com/magento/magento2/issues/26976)

<!-- MC-39783-->

* インデックスが **スケジュールに従って更新** に設定されている場合、マルチサイトデプロイメントでデフォルト以外の web サイトを削除すると、管理者の顧客グリッドを期待どおりに使用できるようになりました。 以前は、アプリケーションでグリッドが表示されず、次のエラーがスローされていました。`[2020-12-09 11:31:54] report.CRITICAL: The website with id 2 that was requested wasn't found. Verify the website and try again. \{"exception":"[object] (Magento\\Framework\\Exception\\NoSuchEntityException(code: 0): The website with id 2 that was requested wasn't found. Verify the website and try again. at /var/www/html/magento24ee/vendor/magento/module-store/Model/WebsiteRepository.php:110)"}`

### dotdigital

* Dotdigital Engagement Cloud からプログラムのリストを取得する際のエラー処理が改善されました。

* ゲスト同期中にストア名列で同期される値が、ストア表示名として期待どおりのものになりました。 以前は、この列には web サイト名が含まれていました。

* 注文を保存した後、注文ステータスの自動化をループする前に配列チェックを追加しました。

* dotdigital モジュールの `magento/module-authorization` への依存の結果である Composer のアップグレードに関する問題を解決しました。

### ダウンロード可能

<!-- ENGCOM-7679 -->

* 所属する注文が一部返金された後、アプリケーションの「マイダウンロード製品」タブにダウンロード可能な製品が表示されなくなりました。 [GitHub-28388](https://github.com/magento/magento2/issues/28388)

### EAV

<!-- MC-35934-->

* `\Magento\Eav\Model\Entity\Attribute\Backend\ArrayBackend` を使用するカスタム属性では、API 呼び出しによって製品が作成される際にペイロードに値が指定されていない場合、デフォルト値を使用するようになりました。

### 電子メール

<!-- ENGCOM-7961 -->

* `toOptionArray()` 前に `\Magento\Config\Model\Config\Source\Email\Template::toOptionArray` が呼び出されない場合に、`setPath()` がエラーをスローしなくなりました。 [GitHub-29315](https://github.com/magento/magento2/issues/29315)

<!-- MC-36777-->

* メールテンプレートを読み込む際に「**Html バージョンを返す**」をクリックすると、プレーンテキストがHTMLに正しく変換されるようになりました。

<!-- MC-34803-->

* 部分請求書を含む顧客に送信されるメールに、正確な品目小計が含まれるようになりました。 以前は、この電子メールの小計は、請求済数量の合計金額ではなく、注文済数量の合計でした。

<!-- MC-38337-->

* アプリケーションは、有効なメールアドレスを持つすべての関連する顧客にリマインダーを送信するようになりました。 以前は、1 つの無効なアドレスに遭遇すると、アプリケーションは顧客へのリマインダーメールの送信を停止していました。

<!-- ENGCOM-7517 -->

* 非同期モードでの販売 E メールの送信が、製品がカタログから削除された後、期待どおりに機能するようになりました。 以前は、非同期メール送信がブロックされ、アプリケーションに「`main.ERROR: Cron Job sales_send_order_invoice_emails has an error: Call to a member function getData() on null. Statistics: {"sum":0,"count":1,"realmem":0,"emalloc":0,"realmem_start":73400320,"emalloc_start":37177640} [] []main.CRITICAL: Error when running a cron job {"exception":"[object] (RuntimeException(code: 0): Error when running a cron job at /var/www/html/vendor/magento/module-cron/Observer/ProcessCronQueueObserver.php:327, Error(code: 0): Call to a member function getData() on null at /var/www/html/vendor/magento/module-catalog/Helper/Image.php:502)"} []`」というエラーが表示されていました。 [GitHub-26878](https://github.com/magento/magento2/issues/26878)

<!-- ENGCOM-8381 -->

* `sales_email/order_comment/enabled` が無効で、`sales_email/order_comment/copy_method` が `bcc` に設定されている場合、注文確認メールの顧客はコピーされなくなります。 [GitHub-29915](https://github.com/magento/magento2/issues/29915)

### フレームワーク

<!-- MC-24195-->

* カスタマイズされたフィルターグループが、顧客の検索時に正しく適用されるようになりました。 以前は、`afterSearch` 関数は、期待どおりに OR フィルターしませんでした。 [GitHub-24576](https://github.com/magento/magento2/issues/24576)

<!-- MC-36942-->

* ストアのホームページ上の画像が正常にレンダリングされるようになりました。 以前は、画像の base64 コードの 3 つの連続するスラッシュがコメントと誤って解釈されたため、ページソースHTMLが破損していました。

<!-- MC-37369-->

* アラビア語ロケール（`ar_SA - Saudi Arabia`）を使用してストアの管理注文リストの注文をフィルタリングする際に、日付選択が正しく機能するようになりました。

<!-- MC-38344-->

* マーチャントがデプロイメントで買い物かごの価格ルールを保存した後、DatePicker に正しい日付が表示されるようになりました。 [GitHub-30382](https://github.com/magento/magento2/issues/30382)

<!-- MC-31085-->

* このアプリケーションは、アラビア語の桁区切りとアラビア語の小数点記号を正しく表すようになりました。 以前は、アラビア語の記号がトリミングされていました。 [GitHub-26676](https://github.com/magento/magento2/issues/26676)

<!-- MC-30631-->

* アプリケーションは、データベースの `session` テーブルから期限切れのデータベースセッションを期待どおりに削除するようになりました。

### 一般的な修正点

<!-- MC-38105-->

* `php.ini` で定義されているものとは異なるネイティブセッションハンドラーを設定できるようになりました。 以前は、`SessionManager` は memcache を `save_handler` として設定せず、代わりにファイルの `session_handler` を使用していました。 アプリケーションが次のエラーをスローしました：`main.CRITICAL: Warning: SessionHandler::read(): open(127.0.0.1:11211/sess_0imeeaqmnvemdg4e3h57tat0ik, O_RDWR) failed: No such file or directory (2) in../vendor/magento/framework/Session/SaveHandler/Native.php on line 22 {"exception":"[object] (Exception(code: 0): Warning: SessionHandler::read(): open(127.0.0.1:11211/sess_0imeeaqmnvemdg4e3h57tat0ik, O_RDWR) failed: No such file or directory (2) in ../vendor/magento/framework/Session/SaveHandler/Native.php on line 22 at ../vendor/magento/framework/App/ErrorHandler.php:61)"}`。 [GitHub-24717](https://github.com/magento/magento2/issues/24717)

<!-- ENGCOM-8052 -->

* `LoginAsCustomer` のモジュールが次のように改善されました。

   * `around` プラグインを `after` に置き換えました

   * 冗長コードを削除しました

   * `(bool)->getValue()` を `isSetFlag` に置き換えました。 [GitHub-29689](https://github.com/magento/magento2/issues/29689)

<!-- ENGCOM-8093 -->

* ワイルドカード（*）を使用してすべての顧客データセクションを再読み込みしても、リクエストが `customer/section/load` で 400 エラーがスローされなくなりました。 [GitHub-28154](https://github.com/magento/magento2/issues/28154)

<!-- ENGCOM-7994 -->

* アプリケーションは、実稼動モードでレイアウトがレンダリングされる際に発生する例外を `var/report` に渡すようになりました。 [GitHub-29606](https://github.com/magento/magento2/issues/29606)

<!-- MC-35058-->

* マーチャントは、期待どおりにカテゴリから製品の割り当てを解除できるようになりました。 以前は、アプリケーションは次のようなエラーをスローしていました：`Could not save product "4" with position 0 to category 3`。

<!-- ENGCOM-7527 -->

* 存在しないお客様がパスワードのリセットをリクエストした場合、アプリケーションが例外をスローするようになりました。 [GitHub-26288](https://github.com/magento/magento2/issues/26288)

<!-- MC-33687 ENGCOM-8497-->

* 顧客属性に無効な値を含む顧客アカウントを、この属性値を持つファイルのアップロード中に保存しようとすると、情報エラーメッセージが表示されるようになりました。 以前は、アプリケーションは致命的なエラーをスローしました。 [GitHub-30295](https://github.com/magento/magento2/issues/30295)

<!-- ENGCOM-8400 -->

* **HTMLの印刷表示のロゴ** 設定が、想定どおりに請求書PDFを保存できるようになりました。 [GitHub-24730](https://github.com/magento/magento2/issues/24730)

<!-- ENGCOM-8425 -->

* `static::` は、プライベート定数にアクセスするために、コードベース全体で `self::` に置き換えられました。 [GitHub-30781](https://github.com/magento/magento2/issues/30781)

<!-- ENGCOM-8395 -->

* 商品の作成中にマーチャントが「**新しい属性を作成**」ボタンを 2 回クリックすると、アプリケーションで新規属性ページが期待どおりに開くようになりました。 以前は、アプリケーションで空のページが表示され、エラーがスローされていました。 [GitHub-30361](https://github.com/magento/magento2/issues/30361)

<!-- ENGCOM-8426 -->

* クーポンが削除された後、アプリケーションに `The coupon code has been accepted` メッセージが表示されなくなります。 [GitHub-30255](https://github.com/magento/magento2/issues/30255)

<!-- ENGCOM-8396 -->

* 管理者はウィジェットを特定のカテゴリに割り当てることができるようになりました。 [GitHub-30009](https://github.com/magento/magento2/issues/30009)

<!-- ENGCOM-8216 -->

* 属性セレクター `input[type=datetime]` は、あまり具体的でない入力タイプセレクターに置き換えられました。 [GitHub-30064](https://github.com/magento/magento2/issues/30064)

<!-- ENGCOM-8282 -->

* アプリケーションは、カスタムカテゴリ属性に関連付けられているストア固有の値を期待どおりに表示するようになりました。 [GitHub-13440](https://github.com/magento/magento2/issues/13440)

<!-- ENGCOM-8287 -->

* 店舗住所と出荷先が異なる EU 諸国に属している場合、注文作成ページの **VAT 番号を検証** ボタンをクリックすると、顧客グループを変更する必要があるかどうかを尋ねるプロンプトが表示されるようになりました。 [GitHub-29652](https://github.com/magento/magento2/issues/29652)

<!-- ENGCOM-8031 -->

* `\Magento\Catalog\Model\ImageUploader` クラスは、新しい `moveFileFromTmp` メソッドを使用するようにリファクタリングされています。 [GitHub-29598](https://github.com/magento/magento2/issues/29598)

<!-- ENGCOM-8178 -->

* マーチャントが `product_type` コードと `type_id` コードを使用して製品属性を作成しようとしたときに、より詳細なエラーメッセージが表示されるようになりました。 [GitHub-28479](https://github.com/magento/magento2/issues/28479)

<!-- ENGCOM-8135 -->

* 管理 **ストア**/**設定**/**サービス**/**OAuth** ページの **顧客トークンの有効期間（時間）** および **管理トークンの有効期間（時間）** フィールドの検証ロジックを修正しました。 [GitHub-29502](https://github.com/magento/magento2/issues/29502)

<!-- ENGCOM-8132 -->

* アプリケーションは、ウィジェットコンテンツフィールドに `}}` を含むテキストを正しく解析するようになりました。 [GitHub-12087](https://github.com/magento/magento2/issues/12087)

<!-- ENGCOM-8098 -->

* 製品カテゴリページからフィルターを削除できるようになりました。 以前は、フィルターを削除しようとすると、アプリケーションはフィルターを削除できず、次のエラーが表示されていました：`Something went wrong`。 [GitHub-8538](https://github.com/magento/magento2/issues/8538)

<!-- ENGCOM-8050 -->

* `Magento\Framework\MessageQueue\ConfigInterface` は、オプションのモジュール `Magento_MessageQueue` が無効な場合でもインスタンス化できるようになりました。 以前は、アプリケーションは次のエラーをスローしていました：`PHP Fatal error:  Uncaught Error: Cannot instantiate interface Magento\Framework\MessageQueue\ConfigInterface in /var/www/magento2/magento2/lib/internal/Magento/Framework/ObjectManager/Factory/AbstractFactory.php:121`。 [GitHub-26080](https://github.com/magento/magento2/issues/26080)

<!-- ENGCOM-7312 -->

* アプリケーションが永続ストレージからメール値を取得できるタイミングを決定するロジックが改善されました。 以前は、未登録ユーザーがメールフィールドを最初に完了した後にチェックアウトページに戻ると、アプリケーションはチェックアウトページに入力されたパスワードフィールドを表示していました。 [GitHub-26903](https://github.com/magento/magento2/issues/26903)

<!-- ENGCOM-7777 -->

* 見つからない `aclResource` 属性が Admin ヘッダー `AdminNotification` ツールバーブロックに追加されました。 以前は、管理者ユーザーがロールリソース権限を持っていない場合でも、管理者通知ツールバーエントリが表示されていました。 [GitHub-29067](https://github.com/magento/magento2/issues/29067)

<!-- ENGCOM-8022 -->

* `framework/database/select` `where` 関数が `type` を正しく処理するようになりました。 [GitHub-29590](https://github.com/magento/magento2/issues/29590)

<!-- ENGCOM-8260 -->

* ループ内での `array_merge` の非効率的な使用がコードベース全体で改善されました。コードベースは、静的コンテンツのデプロイメントプロセスを含む複数の場所でパフォーマンスを向上させました。 [GitHub-30183](https://github.com/magento/magento2/issues/30183)

<!-- ENGCOM-8445 -->

* 既定の管理者セッションの有効期間は、暗号化モジュールからセキュリティ モジュールに移動されました。 [GitHub-30859](https://github.com/magento/magento2/issues/30859)

<!-- ENGCOM-8425 -->

* クラス内のプライベート定数がチェックされ、`static::` 呼び出しがある場合は警告が表示されるようになりました。 以前は、アプリケーションは次のエラーをスローしていました：`Undefined class constant`。

<!-- ENGCOM-8326 -->

* エラーページとメンテナンスモードでのシンボリックリンクされた `root` のサポートを追加しました。 以前は、`root` または `magento/pub` が別のディレクトリにシンボリックリンクされている場合、エラープロセッサー（`Magento\Framework\Error\Processor`）は正しい表示ファイル URL を生成しませんでした。 [GitHub-30296](https://github.com/magento/magento2/issues/30296)

<!-- ENGCOM-8087 -->

* 不足している `order_data` 配列を `EmailSender` クラスに追加しました。 これにより、これらのクラスは、メールテンプレート内のオブジェクトの代わりにスカラー変数を使用することをMagentoが推奨する方法と整合します。 [GitHub-29604](https://github.com/magento/magento2/issues/29604)

### GraphQL

<!-- MC-37615-->

* GraphQL URL リゾルバーでクエリパラメーターが正しく処理されるようになりました。 以前は、パラメーターを使用して SEO に対応する URL を処理する場合に NULL が返されていました。

<!-- ENGCOM-8422 -->

* GraphQL URL リゾルバーでCMS ページ階層が正しく処理されるようになりました。 以前は NULL を返していました。 [GitHub-30474](https://github.com/magento/magento2/issues/30474)

<!-- MC-38209-->

* 製品の `categories.breadcrumbs` データのクエリで、親カテゴリが無効になっているカテゴリのパンくずデータが返されなくなりました。 [GitHub-30468](https://github.com/magento/magento2/issues/30468)

<!-- MC-38407-->

* URL の書き換えが無効な場合に、カテゴリ画像へのパスが正しく返されるようになりました。

<!-- MC-36648-->

* GraphQLのパスワードのリセット中にでエラーが発生した場合、より詳細なメッセージを返すようになりました。 [GitHub-30179](https://github.com/magento/magento2/issues/30179)

<!-- MC-38078-->

* 商品のポジションは、クエリ結果がキャッシュされる際に、GraphQLのクエリ結果で期待どおりに更新されるようになりました。

<!-- MC-35355-->

* `category_id` の場合、`products` クエリは期待される結果を返すようになりました。  filter は `in` キーワードで指定します。 [GitHub-30349](https://github.com/magento/magento2/issues/30349)

<!-- ENGCOM-8219 -->

* JSON ファイルと YAML ファイルの 2 つのスペースへのインデントをサポートするルールを `editorconfig` に追加しました。 [GitHub-30066](https://github.com/magento/magento2/issues/30066), [GitHub-30063](https://github.com/magento/magento2/issues/30063)

<!-- ENGCOM-8079 -->

* `FlushCacheByTags` クラスが更新されて、プラグインの周囲ではなくアフタープラグインを使用するようになりました。 [GitHub-29558](https://github.com/magento/magento2/issues/29558)

<!-- ENGCOM-8370 -->

* `checkout_index_index.xml` ファイルのコードは、`messages`、`authentication`、`progressBar`、`estimation` および `sidebar checkout` のコンポーネントから `sortOrder` が削除されたことにより強化されました。 [GitHub-30550](https://github.com/magento/magento2/issues/30550)

<!-- ENGCOM-8379 -->

* `calc` のコンテンツがエスケープされるようになり、CSS 出力ファイルの `calc` 値が正しくなります。 以前は、アプリケーションが誤った `calc` 値を返していました。 [GitHub-30542](https://github.com/magento/magento2/issues/30542)

<!-- ENGCOM-8030 -->

* URL 書き換えジェネレーターで、グローバルスコープのカテゴリ URL 書き換えを保存する際に、カテゴリオブジェクト `url_key`、`url_path`、`store_id` をデフォルトのストア値に設定するようになりました。 以前は、最後に処理されたストア ID の値を使用して、`url_key`、`url_path`、`store_id` が保存されていました。 [GitHub-29585](https://github.com/magento/magento2/issues/29585)## グループ化された製品

<!-- MC-35361-->

* 製品クエリは、グループ化された製品に必要なすべてのデータを返すようになりました。 以前は、`product_links` は空の配列でした。

<!-- MC-37718-->

* すべての子のシンプル製品が在庫切れになった場合、グループ化された製品が製品編集ページに在庫切れとリストされるようになりました。

<!-- MC-37249-->

* 子のシンプル製品のステータスが在庫切れに変更された場合、グループ化された製品のステータスが製品編集ページで正しく更新されるようになりました。 以前は、グループ化された製品の親の在庫品目が、その子が在庫ステータスを変更した後で更新されませんでした。

<!-- ENGCOM-8250 -->

* `\Magento\Widget\Controller\Adminhtml\Widget\Instance\Validate` は、フレーズの結果値をエラーメッセージとして認識し、ウィジェットの検証中にユーザーに出力するようになりました。 [GitHub-27397](https://github.com/magento/magento2/issues/27397)

<!-- ENGCOM-8311 -->

* `Magento\Catalog\Model\Category\DataProvider::getFieldsMap()` のカテゴリ属性のハードコーディングされたリストは、キャッシュから生成された属性のリストに置き換えられました。 [GitHub-13440](https://github.com/magento/magento2/issues/13440)

<!-- ENGCOM-7759 -->

* `req.http.host/client.ip` の冗長なハッシュは削除され、ハッシュは Varnish 組み込み VCL によって処理されます。 [GitHub-29988](https://github.com/magento/magento2/issues/29988)

<!-- ENGCOM-8302 -->

* `Magento_Ui` ファイルアップローダに失敗コールバックを追加しました。 [GitHub-29557](https://github.com/magento/magento2/issues/29557)

<!-- ENGCOM-8405 -->

* `Magento_LoginAsCustomerAssistance` が有効になっていたが、`Magento_LoginAsCustomerAdminUi` または `Magento_LoginAsCustomerLog` が無効になっていたときに発生した `acl.xml` の不整合が修正されました。 以前は、これらの資格情報を持つ管理者が管理者にログインしようとすると、アプリケーションで空白のページが表示され、`Exception #0 (LogicException): Could not create an acl object: Invalid Document Element 'resource': The attribute 'title' is required but missing. Line: 13` の際にエラーがスローされていました。 [GitHub-30680](https://github.com/magento/magento2/issues/30680)

<!-- ENGCOM-8157 -->

* プラグインの作成中に `Interceptor` が生成されると、アプリケーションが `Undefined class constant` エラーをスローしなくなりました。 [GitHub-28981](https://github.com/magento/magento2/issues/28981), [GitHub-29879](https://github.com/magento/magento2/issues/29879)

<!-- ENGCOM-8108 -->

* アプリケーションは、非同期の一括操作のメッセージングとログを正しく処理できるようになりました。 以前は、製品は更新されましたが、`magento_operation` テーブルと `queue_message_status` テーブルが正しく更新されず、システムメッセージが正しくありませんでした。 [GitHub-29718](https://github.com/magento/magento2/issues/29718)

<!-- ENGCOM-8388 -->

* 買い物客は、ストアで **メール確認を要求** が有効になっている場合に、パスワードリセットメールで **新しいパスワードを設定** をクリックすると、期待どおりに新しいパスワードを設定ページにリダイレクトされるようになりました。 以前は、買い物客はログインページの **パスワードを忘れた場合** ボタンにリダイレクトされていました。 [GitHub-27954](https://github.com/magento/magento2/issues/27954)

<!-- ENGCOM-8337 -->

* デフォルト値を使用して行システム設定を保存する際の、配列から文字列への変換エラーを修正しました。 [GitHub-30314](https://github.com/magento/magento2/issues/30314)

<!-- ENGCOM-8440 -->

* メッセージキューの引数を設定できるようになりました。 [GitHub-30216](https://github.com/magento/magento2/issues/30216)

<!-- ENGCOM-8384 -->

* ベースファイルコレクターは `AppState->emulateAreaCode()` を尊重するようになりました。 [GitHub-39656](https://github.com/magento/magento2/issues/29656)

<!-- ENGCOM-8441 -->

* 新しい `BlockByIdentifier` クラスは、CMS ブロック識別子に基づくレイアウトブロックの取得をサポートしています。 その結果、CMS ブロックがキャッシュから削除されると、レイアウトブロックのキャッシュもクリアされます。 [GitHub-28309](https://github.com/magento/magento2/issues/28309)

<!-- ENGCOM-8385 -->

* キュー内の数値引数の変換に関する問題を修正しました。 以前は、`queue_topology.xml` で数値 `type` 引数を持つキューを宣言した場合、引数の値は string にキャストされていました。 [GitHub-29615](https://github.com/magento/magento2/issues/29615)

### GraphQL

<!-- MC-37615-->

* `urlResolver` クエリでクエリパラメーターが正しく処理されるようになりました。

<!-- ENGCOM-8422 -->

* カスタム CMS ノードとページを入力として指定した場合に、`urlResolver` クエリが NULL を返さなくなりました。 [GitHub-30474](https://github.com/magento/magento2/issues/30474)

<!-- MC-38209 ENGCOM-8386-->

* `category` クエリは、無効になった親カテゴリの子カテゴリを返さなくなりました。 [GitHub-30468](https://github.com/magento/magento2/issues/30468)

<!-- MC-38407-->

* URL の書き換えが無効な場合、`category` クエリがカテゴリ画像の正しいパスを返すようになりました。

<!-- MC-36648 8321-->

* エラーが発生した場合に、`resetPassword` のミューテーションが、より詳細なメッセージを返すようになりました。 [GitHub-30179](https://github.com/magento/magento2/issues/30179)

<!-- MC-38078 ENGCOM-8504-->

* `products` クエリのキャッシュされた結果は、製品の位置が変更されると、期待どおりに無効になります。 [GitHub-30467](https://github.com/magento/magento2/issues/30467)

<!-- MC-35355 ENGCOM-8404-->

* `category_id` フィルターが `in` キーワードで指定されている場合、`products` クエリは期待される結果を返すようになりました。 [GitHub-30349](https://github.com/magento/magento2/issues/30349)

<!-- ENGCOM-8373 -->

* `categories` クエリと `categoryList` クエリでは、カテゴリ権限設定と親カテゴリ ID に基づいてカテゴリの可用性を考慮するようになりました。 [GitHub-29880](https://github.com/magento/magento2/issues/29880), [GitHub-30624](https://github.com/magento/magento2/issues/30624)

<!-- MC-37603-->

* `updateProductsInWishList` ミューテーションは、ウィッシュリスト項目を正しく検証するようになりました。 [GitHub-30467](https://github.com/magento/magento2/issues/30467)

<!-- ENGCOM-8430 PWA-1107-->

* ストアフロントでの使用を防ぐため、`ProductInterface` および `CategoryInterface` のいくつかの属性を非推奨（廃止予定）にしました。 [GitHub-30625](https://github.com/magento/magento2/issues/30625)

* カテゴリ権限が非表示に設定されている場合、価格が製品クエリ結果に表示されなくなりました。 [GitHub-29926](https://github.com/magento/magento2/issues/29926)

<!-- MC-36898 PWA-1299-->

* `addProductsToWishList` のミューテーションを使用して、数量がユーザー定義のバンドル製品をウィッシュリストに追加できるようになりました。

<!-- MC-36946 -->

* 「買い物かごに追加」操作に対するGraphQLの応答時間が改善されました。

<!-- ENGCOM-8099 -->

* `products` クエリは、期待どおりに階層価格値を返すようになりました。 [GitHub-29168](https://github.com/magento/magento2/issues/29168)

<!-- ENGCOM-7528 -->

* `lib/internal/Magento/Framework/GraphQl/Query/EnumLookup.php` のループから冗長 `getMappedNums` を削除しました。 [GitHub-30031](https://github.com/magento/magento2/issues/30031)

<!-- ENGCOM-8172 -->

* クエリされた製品に無効な関連製品がある場合、`products` クエリがエラーを返さなくなりました。 [GitHub-28892](https://github.com/magento/magento2/issues/28892)

<!-- MC-37395 -->

* `cart` クエリでは、正しい通貨（デフォルトの表示通貨）に変換された価格を返すようになりました。 以前は、クエリは基本通貨で項目価格の値を返し、通貨コードはデフォルトの表示通貨として返されていました。

<!-- MC-37388-->

* GraphQLは、カタログ権限に従うようになりました。 アプリケーションは、買い物客の顧客グループに基づいて、`products` クエリに対して返される項目を制限します。

<!-- MC-39690-->

* `CartItemInterface` を実装する複数のデータタイプに `customizable_option` 属性を追加しました。

<!-- MC-39744-->

* `storeConfig` クエリの属性を追加して、ストア、ストアグループ、web サイト情報を返すようにしました。

<!-- MC-37414-->

* `SelectedCustomizableOption.type` 属性を元に戻しました。 さらに、`CartItemInterface` の様々な実装内の `customizable_options` 属性が null 以外になりました。

<!-- MC-23860-->

* `products` クエリの検索機能で、カテゴリ権限が有効になっている項目を返さなくなりました。

<!-- MC-37726-->

* `products` クエリは、複数通貨を持つストアビューに対して正しい通貨を返します。

<!-- MC-37727-->

* デフォルト以外のストアビューに適用できる場合、`products` クエリフィルターのラベルが翻訳済みの値を返すようになりました。

<!-- MC-37728-->

* カート内のギフト カードの店舗の固定通貨金額。

<!-- MC-38443-->

* 商品の選択可能な設定可能なオプションに対応するメタデータを含む、`ConfigurableProductOptionsSelection` データタイプを追加しました。 このオブジェクトを `products` クエリで使用すると、買い物客が設定可能な製品オプションを選択したときに表示されるメディアギャラリー項目の数を最小限に抑えることができます。

### 画像

<!-- MC-36942-->

* ストアのホームページ上の画像が正常にレンダリングされるようになりました。 以前は、画像の base64 コードの 3 つの連続するスラッシュがコメントと誤って解釈されたため、ページソースHTMLが破損していました。

<!-- ENGCOM-8116 -->

* `fileinfo` 拡張機能の依存関係がCMS モジュールから削除されました。 以前は、画像アップローダを使用して画像をアップロードしようとすると、アプリケーションがエラーをスローしていました。このエラーは、コンテンツを追加する際に「**画像を挿入**」ボタンをクリックすると起動されます。 [GitHub-24332](https://github.com/magento/magento2/issues/24332), [GitHub-16531](https://github.com/magento/magento2/issues/16531), [GitHub-29852](https://github.com/magento/magento2/issues/29852)

<!-- ENGCOM-8020 -->

* `exif_image.png` または `exif-image.jpeg` メタデータの読み取りがサポートされるようになりました。 [GitHub-1449](https://github.com/magento/adobe-stock-integration/issues/1449)

<!-- ENGCOM-8296 -->

* CMYK イメージのカラーが正しくレンダリングされるようになりました。 Imagick アダプターが、開かれた画像に CMYK カラースペースがあることを検出すると、カラースペースは SRGB に変換されます。 以前は、これらのイメージは反転カラーでレンダリングされていました。 [GitHub-22375](https://github.com/magento/magento2/issues/22375)

<!-- ENGCOM-8251 -->

* `image_with_border.phtml` ではブール値は設定されなくなりました。 冗長な `max-width` と `height` の設定が `.product-image-photo` から削除されました。 （これらの値は、リセットスタイルを使用して画像上で既にグローバルに設定されています。） [GitHub-30186](https://github.com/magento/magento2/issues/30186)

### インポート/エクスポート

<!-- MC-35081-->

* 特定のフィールド値が削除されている CSV ファイル（`entity type = "customer address"` および `import behavior = "add/update"`）を使用して顧客アドレスを読み込むと、顧客アドレス `region_id` に `NULL` しい値が割り当てられなくなりました。

<!-- MC-35295-->

* 読み込み時にストアフロントで製品画像を非表示にできるようになりました。

<!-- MC-35836-->

* 読み込ま `qty` た商品が CSV ファイルで 0 に設定されていて、1 に `is_in_stock set` 定されている場合、その商品はカテゴリページにリストされず、商品詳細ページに在庫切れと表示されます。 以前は、これらの値を持つ製品は、読み込み後にストアフロントに表示されていました。

<!-- MC-38433-->

* CSV の読み込みで、追加の属性の `dropdown` と `textarea` の値が無視されなくなりました。 以前は、読み込み時にこれらの属性値が更新されていませんでした。

<!-- MC-37933-->

* 製品の書き出し CSV ファイルが、管理者リストに、期待どおりに書き出し CSV ファイルとして表示されるようになりました。 以前は、次のコマンドを実行すると、アプリケーションがエラーをスローしていました：`bin/magento queue:consumers:start exportProcessor --single-thread --max-messages=10000`。

<!-- MC-37672-->

* ベンガル語（バングラ）のアルファベット文字を含む CSV データを読み込むと、アプリケーションでエラーがスローされなくなりました。

<!-- MC-36410-->

* Chromeで作業している場合に、書き出し後に変更されたファイルを読み込む際に、管理者が **データを確認** をクリックすると、情報エラーメッセージが表示されるようになりました。 以前は、アプリケーションでコンソールエラーが表示されましたが、続行方法はユーザーに伝えられていませんでした。

<!-- ENGCOM-8252 -->

* 同じ製品の CSV データを 2 回以上読み込んでも、製品画像が重複しなくなりました。 [GitHub-21885](https://github.com/magento/magento2/issues/21885)

<!-- ENGCOM-8262 -->

* `vendor/magento/framework/File/Uploader.php` の画像ファイル名の上限である 90 文字が削除されました。  以前は、ディレクトリとファイル名の長さは 255 文字以下でした。 ファイル名がこの制限を超える画像を含む製品がインポートされましたが、画像ファイルはインポートされませんでした。 [GitHub-29377](https://github.com/magento/magento2/issues/29377)

<!-- ENGCOM-8153 -->

* クーポンコードを CSV または XML に正常に書き出せるようになりました。 以前は、クーポンを書き出そうとした際に「**CSV を書き出し**」または「**XML を書き出し** をクリックすると、アプリケーションに 404 エラーが表示されていました。 [GitHub-29277](https://github.com/magento/magento2/issues/29277)

<!-- ENGCOM-8252 -->

* 画像を含む CSV ファイルを読み込んだ後、重複した製品画像が削除されるようになりました。 [GitHub-14398](https://github.com/magento/magento2/issues/14398), [GitHub-21885](https://github.com/magento/magento2/issues/21885)

### 索引

<!-- MC-38003-->

* 部分インデクサーのパフォーマンスを向上しました。 1000 ID のバッチイテレーションごとに変更されたキャッシュ ID をクリアするようになりました。 キャッシュコンテキストに ID が蓄積されなくなりました。 以前は、キャッシュコンテキストは、1000 ID のバッチの反復ごとにキャッシュ ID を蓄積し、各反復で同じ ID のセットをクリアしていました。

<!-- ENGCOM-7929 -->

* 部分再インデックス化システムと完全再インデックス化システムの間の不整合が修正されました。 両方のインデックス作成システムで同じコードが使用されるようになり、正しく機能します。 以前は、両方のインデックスシステムは、共有インデクサーに関して異なるロジックを使用していました。これにより、部分的なインデックス再作成システムの実行ごとにインデクサーが無効化される可能性がありました。 [GitHub-29478](https://github.com/magento/magento2/issues/29478), [GitHub-29297](https://github.com/magento/magento2/issues/29297)

<!-- MC-38168-->

* 手動インデクサーの問題を解決しました。この問題により、カテゴリページが空になったり、カテゴリページの製品数が減ったりしていました。 次の場合に、不完全なカテゴリページまたは製品数に関する問題が発生しました。

   * `catalogsearch_fulltext` および `catalog_product_price` の部分インデクサーは、これらのインデクサーの実行が完了するまで、大きなカタログで実行されました。

   * 部分インデクサーは、`catalog_category_product` または `catalog_product_category` のいずれかのインデックスで実行され、同時にそれらのインデックスのいずれかに対して完全な再インデックスが実行されました。 これらの 2 つのインデックス作成プロセスが競合し、その結果、製品がカテゴリページに見つからない可能性があります。

   * `bin/magento indexer:reindex inventory` は大規模なカタログで実行されました。 `catalogsearch_fulltext` 部分インデクサーの実行が完了するまで、カテゴリページに製品が表示されませんでした。

<!-- MC-39700-->

* `Magento_Bulk` MySQL テーブルにインデクサーが追加され、一括操作のパフォーマンスが向上しました。

<!-- MC-38806-->

* データベーステーブルのコメントに、インデックス再作成後のテーブルのステータスが正確に反映されるようになりました（`bin/magento indexer:reindex`）。 以前は、再インデックス後のテーブルコメントには、新規インストール後のコメントと同じ値が含まれていました。

<!-- ENGCOM-7542 -->

* `SELECT entity_id IN` ステートメントは、MariaDB v.10.3.18 を実装するデプロイメントで改善され、カタログカテゴリインデックス作成のパフォーマンスが向上しました。 [GitHub-25199](https://github.com/magento/magento2/issues/25199)

<!-- ENGCOM-8237 -->

* Magento Open Sourceでは、インデクサーインスタンスごとにタグを複数回フラッシュする必要がなくなったので、キャッシュパフォーマンスが向上しました。 [GitHub-29890](https://github.com/magento/magento2/issues/29890)

### インフラストラクチャ

<!-- MC-34353-->

* `app/etc/env.php` を使用して、メッセージブローカーを MYSQL から AMQP に変更できるようになりました。

<!-- MC-38242-->

* 関連するJavaScript ライブラリで、商品の数量の小数値の残数の計算に関する問題が修正されました。 アプリケーションは、以前に計算した 2 桁を超える小数点以下の桁数が正しく計算されず、その後、誤ったメッセージが表示されていました。

<!-- MC-38993 ENGCOM-8473-->

* `\Magento\Authorization\Model\Rules::update` メソッドは非推奨（廃止予定）になりました。  [GitHub-29128](https://github.com/magento/magento2/issues/29128)

<!-- ENGCOM-8000 -->

* 日付オブジェクトを UTC から変換する際に、アプリケーションで致命的なエラーがスローされなくなりました。 以前は、特定の条件下で、`convertConfigTimeToUtc` メソッドが例外をスローしていました。 [GitHub-29525](https://github.com/magento/magento2/issues/29525)

<!-- ENGCOM-7987 -->

* `DataObject` は `\Magento\MediaGalleryCatalogUi\Ui\Component\Listing\Columns\Thumbnail::prepareDataSource` の製品モデルに置き換えられました。[GitHub-1711](https://github.com/magento/adobe-stock-integration/issues/1711)

<!-- ENGCOM-7914 -->

* `RequireJS` リゾルバーは、ブロックされたリソースを検出できなくなりました。 以前は、リゾルバーは、ページ上のすべてのリソースが適切に読み込まれているか処理されているかを正しく検出せず、ページの読み込みを続行していました。 [GitHub-28116](https://github.com/magento/magento2/issues/28116)

<!-- ENGCOM-8229 -->

* 属性リポジトリコードの検証で、ハードコードされた値ではなく `Magento\Eav\Model\Entity\Attribute::ATTRIBUTE_CODE_MAX_LENGTH` が考慮されるようになりました。 [GitHub-29017](https://github.com/magento/magento2/issues/29017)

<!-- MC-35699-->

* HTMLの縮小で、PHTML ファイルのHTML文字列から 3 つのスラッシュ（//）が削除されなくなりました。 以前は、縮小時にトリプルスラッシュがコメントとして解釈され、残りの行は展開時に生成された PHTML ファイルで完全に削除されていました。

<!-- MC-38201-->

* マーチャントは、テーブルレベルではなくテーブル列レベルでインデクサー購読を設定できるようになりました。 `\Magento\Framework\Mview\View\Subscription` に新しい引数が追加され、特定のビューまたはテーブルの組み合わせで列を無視できるようになりました。 [GitHub-30243](https://github.com/magento/magento2/issues/30243)

<!-- MC-30171-->

* 製品ページ JavaScriptが完全に初期化される前に「**買い物かごに追加**」ボタンをクリックしても、`form_key` 値が重複しなくなりました。 以前は、例外をトリガーしたキャッシュされた `form_key` 値を使用して、製品を買い物かごに追加することができました。 JavaScriptが完全に初期化される前に **買い物かごに追加** をクリックすると、フォームデータで送信された `form_key` 値がユーザーセッションと一致せず、商品が買い物かごに追加されませんでした。 [GitHub-13746](https://github.com/magento/magento2/issues/13746)

<!-- ENGCOM-8107 -->

* 現在の cURL クライアントは、大文字と小文字を区別しないヘッダー名を尊重するようになりました。 以前は、`Set-Cookie` の比較では大文字と小文字が区別され、一部の HTTP サーバーで問題が発生する可能性がありました。 [GitHub-29524](https://github.com/magento/magento2/issues/29524)

<!-- ENGCOM-8360 -->

* `api-functional` およびテストケース XML ファイルの XSD URN 形式を更新しました。 [GitHub-30552](https://github.com/magento/magento2/issues/30552)

<!-- ENGCOM-8295 -->

* イベントのプレフィックスとイベントオブジェクトがカタログ製品オプションの値のコレクションに追加され、`\Magento\Catalog\Model\ResourceModel\Product\Option\Value\Collection` のコレクション読み込みのカスタマイズが改善されました。 [GitHub-29621](https://github.com/magento/magento2/issues/29621)

<!-- ENGCOM-8261 -->

* `array_merge` のすべての出現箇所は、コーディング標準で推奨されている形式を使用するようにリファクタリングされています。 [GitHub-30005](https://github.com/magento/magento2/issues/30005)

<!-- ENGCOM-7718 -->

* タイプ `\Magento\Framework\View\Element\Text\ListText` の `head.additional` ブロックが（`magento2/module-base` によって） `adminhtml` `default` レイアウトに追加されました。 [GitHub-29165](https://github.com/magento/magento2/issues/29165)

<!-- ENGCOM-8312 -->

* レイアウトテンプレートモジュールウィジェットに、欠落しているエスケープ URL メソッドを追加しました。 [GitHub-30036](https://github.com/magento/magento2/issues/30036)

<!-- ENGCOM-8127 -->

* `\Magento\Framework\Filesystem\Io\File::read()` メソッドは、`\Magento\Framework\Filesystem\Io\IoInterface::read()` と互換性を持つようになりました。 [GitHub-27866](https://github.com/magento/magento2/issues/27866)

### クラルナ

* PayPal モジュールの依存関係を削除しました。 [GitHub-29421](https://github.com/magento/magento2/issues/29421)

### ログ

<!-- ENGCOM-8443 -->

* `Magento_Logging` モジュールで、新しい値とそれらの前にある値が正しく登録されるようになりました。 以前は、「変更前の値」列の値には、最初の変更か次の変更か、またはデフォルト値が戻された時点に関係なく、「N/A」の値が表示されていました。 [GitHub-26943](https://github.com/magento/magento2/issues/26943)

### メディアギャラリー

<!-- ENGCOM-8014 -->

* 管理者 **ストア**/**設定**/**詳細**/**システム** ページが更新され、正しい製品名（メディアギャラリー）が表示されるようになりました。 ユーザーインターフェイスに対する小規模な再設計が含まれています。 [GitHub-1738](https://github.com/magento/adobe-stock-integration/issues/1738)

<!-- ENGCOM-8019 -->

* Media Gallery の画像の説明の「使用されている場所」セクションにあるリンクに、選択した画像によって期待どおりにフィルタリングされたグリッドが表示されるようになりました。 以前は、表示されたグリッドのタイトルが正しくなく、リストエントリが正確ではありませんでした。 [GitHub-1694](https://github.com/magento/adobe-stock-integration/issues/1694)

<!-- ENGCOM-8019 -->

* メディアギャラリーで複数の画像を正常に編集できるようになりました。 以前は、1 つの画像にタグを追加した後で、2 番目の画像にタグを追加することはできませんでした。 [GitHub-1755](https://github.com/magento/adobe-stock-integration/issues/1755)

<!-- ENGCOM-8015 -->

* メディアギャラリーの画像からタグを削除すると、タグ ドロップダウンメニューが期待どおりに空になります。  [GitHub-1703](https://github.com/magento/adobe-stock-integration/issues/1703)

<!-- ENGCOM-8146 -->

* Media Gallery 同期キューメッセージのバッチ処理がサポートされるようになりました。 [GitHub-1724](https://github.com/magento/adobe-stock-integration/issues/1724)

<!-- ENGCOM-8064 -->

* **拡張メディアギャラリー** が無効になっている場合にメディアギャラリーを開こうとすると、アプリケーションに期待どおりに 404 ページが表示されるようになりました。 [GitHub-1760](https://github.com/magento/adobe-stock-integration/issues/1760)

<!-- ENGCOM-8072 -->

* 例外が発生した場合、`MediaGalleryMetadata` はセグメントリーダーをスキップし、代わりに画像メタデータを期待どおりに解析して表示するようになりました。 以前は、`exif_read_data` セグメントリーダーの例外により、画像メタデータは空でした。 [GitHub-1782](https://github.com/magento/adobe-stock-integration/issues/1782)

<!-- ENGCOM-8069 -->

* フォルダー名の長さを変更しても、画像をメディアギャラリーにアップロードできなくなりました。 Media Gallery では、パス列をタイプ `text` として設定するようになりました。 [GitHub-1778](https://github.com/magento/adobe-stock-integration/issues/1778)

<!-- ENGCOM-8217 -->

* Media Gallery からレンディションが挿入された際に、画像アップローダに正しい画像サイズが表示されるようになりました。 [GitHub-1806](https://github.com/magento/adobe-stock-integration/issues/1806)

<!-- ENGCOM-8467 -->

* パスの検証が `Mediagallery` アップローダプラグインに追加されました。 以前は、検証に失敗し、「古いメディアギャラリーを有効にする **が無効になっている場合、アプリケーションで製品が読み込まれませんでし**。 [GitHub-30649](https://github.com/magento/magento2/issues/30649)

<!-- ENGCOM-8057 -->

* ACL サブリソース `Magento_Cms::media_gallery`、新しいメディアギャラリーに追加および適用され、次の個別の操作に対する設定済みの権限をサポートするようになりました。

   * アセットのアップロード
   * コンテンツへのアセットの挿入
   * アセットの削除
   * フォルダーの作成
   * フォルダーの削除。 [GitHub-1487](https://github.com/magento/adobe-stock-integration/issues/1487)

<!-- ENGCOM-8047 -->

* 長い Media Gallery のテキスト文字列とフォルダー名が切り抜かれなくなりました。 以前は、アプリケーションはテキストと画像を切り抜いて表示し、次のメッセージを表示していました：`We couldn't find any records`。 [GitHub-1763](https://github.com/magento/adobe-stock-integration/issues/1763)、[GitHub-1758](https://github.com/magento/adobe-stock-integration/issues/1758)

<!-- ENGCOM-8042 -->

* 新しいページのコンテンツの編集中に画像が選択されていない場合、「**選択項目を追加**」ボタンが表示されなくなりました。 [GitHub-1769](https://github.com/magento/adobe-stock-integration/issues/1769)

<!-- ENGCOM-8047 -->

* フィルターが、**コンテンツ** / **メディアギャラリー** カテゴリグリッドで期待どおりに適用されるようになりました。 [GitHub-1763](https://github.com/magento/adobe-stock-integration/issues/1763)

<!-- ENGCOM-8183 -->

* Gallery multiply breakpoint options の設定が期待どおりに動作するようになりました。 以前は、ページの読み込み時にメディアクエリを終了機能がトリガーされ `mediaCheck` ので、ブレークポイントオプションの設定が正しく機能しませんでした。 [GitHub-29933](https://github.com/magento/magento2/issues/29933)

### MFTF

<!-- ENGCOM-8359 -->

* 繰り返しアクションが `CheckStaticBlocksTest` のアクショングループに置き換えられました。 [GitHub-30561](https://github.com/magento/magento2/issues/30561)

<!-- ENGCOM-8267 -->

* MFTF のベスト プラクティスに準拠するために、`AdminUpdateCategoryAndMakeInactiveTest` と `VerifyChildCategoriesShouldNotIncludeInMenuTest` がリファクタリングされています。 [GitHub-30058](https://github.com/magento/magento2/issues/30058)

<!-- ENGCOM-8458 -->

* 重複 `AdminOpenCMSBlocksGridActionGroup` を削除しました。 [GitHub-30896](https://github.com/magento/magento2/issues/30896)

<!-- ENGCOM-8156 -->

* `AdminOpentCmsBlockActionGroup` を AdminOpenCmsBlockActionGroup に置き換えました。 [GitHub-29839](https://github.com/magento/magento2/issues/29839)

<!-- ENGCOM-8226 -->

* 非推奨（廃止予定） `GoToAttributeGridPageActionGroup`。 [GitHub-30103](https://github.com/magento/magento2/issues/30103)

<!-- ENGCOM-8061 -->

* `Analytics` モジュールにアクショングループを追加しました。 [GitHub-29500](https://github.com/magento/magento2/issues/29500)

<!-- ENGCOM-7334 -->

* テストの実行後に作成された注文をキャンセルするように、`CheckCheckoutSuccessPageAsRegisterCustomerTest` と `CheckCheckoutSuccessPageAsGuestTest` を更新しました。 [GitHub-28324](https://github.com/magento/magento2/issues/28324)

<!-- ENGCOM-8214 -->

* 冗長性のために `AdminNavigateToPageGridActionGroup` を削除しました。 [GitHub-29838](https://github.com/magento/magento2/issues/29838)

<!-- ENGCOM-8122 -->

* チェックアウトページに移動するための `ActionGroup` を実装しました。 [GitHub-29843](https://github.com/magento/magento2/issues/29843)

<!-- ENGCOM-8124 -->

* 新しいCMSの作成ページに移動するための `AdminOpenCreateNewCMSPageActionGroup` を実装しました。 [GitHub-29824](https://github.com/magento/magento2/issues/29824)

<!-- ENGCOM-8268 -->

* Media Gallery のCMS ページの MFTF テストでのスキップの問題を修正しました。 [GitHub-30164](https://github.com/magento/magento2/issues/30164)

#### 新しいテスト

<!-- ENGCOM-7804 -->

* 管理者の友人にメールを有効にするテストを追加しました。 [GitHub-29145](https://github.com/magento/magento2/issues/29145)

<!-- ENGCOM-8316 -->

* 管理者がCMS ブロックをグリッドから削除するテストを追加しました。 [GitHub-30372](https://github.com/magento/magento2/issues/30372)

<!-- ENGCOM-7933 -->

* 単一のバンドル項目に買い物かごルールを適用するためのテストを追加しました。 [GitHub-28921](https://github.com/magento/magento2/issues/28921)

<!-- ENGCOM-8075 -->

* エンティティが削除された後に、Media Gallery 画像の **使用中** 情報が表示されるかどうかを確認するテストを追加しました。 [GitHub-1774](https://github.com/magento/adobe-stock-integration/issues/1774)

#### 新規アクショングループ

* `AssertStorefrontCustomerLogoutSuccessPageActionGroup`。 [GitHub-29841](https://github.com/magento/magento2/issues/29841) <!-- ENGCOM-8121 -->

* `AdminOpenConfigurationStoresPageActionGroup`。 [GitHub-29848](https://github.com/magento/magento2/issues/29848) <!-- ENGCOM-8259 -->

* `ReloadPageActionGroup`。 [GitHub-30683](https://github.com/magento/magento2/issues/30683) <!-- ENGCOM-8394 -->

* `StorefrontClickRefundTabCustomerOrderViewActionGroup`。 [GitHub-30032](https://github.com/magento/magento2/issues/30032) <!-- ENGCOM-8203 -->

* `AdminOpenAdminThreeDSecurePageActionGroup`。 [GitHub-29845](https://github.com/magento/magento2/issues/29845) <!-- ENGCOM-8115 -->

* `AdminCustomerClickFirstRowEditLinkActionGroup`。  [GitHub-29501](https://github.com/magento/magento2/issues/29501) <!-- ENGCOM-8043 -->

* `StorefrontClickAddToCartButtonActionGroup`。 [GitHub-29823](https://github.com/magento/magento2/issues/29823) <!-- ENGCOM-8113 -->

* `AdminDeleteTaxRateActionGroup`。 [GitHub-29940](https://github.com/magento/magento2/issues/29940) <!-- ENGCOM-8192 -->

* `AdminOpenWebConfigurationPageActionGroup`。 [GitHub-29846](https://github.com/magento/magento2/issues/29846) <!-- ENGCOM-8126 -->

* `AdminOpenGeneralConfigurationPageActionGroup`。 [GitHub-29847](https://github.com/magento/magento2/issues/29847) <!-- ENGCOM-8114 -->

* `AdminOrderClickSubmitOrderActionGroup`。 [GitHub-29649](https://github.com/magento/magento2/issues/29649) <!-- ENGCOM-8023 -->

* `AdminOpenCatalogProductPageActionGroup`。 [GitHub-29941](https://github.com/magento/magento2/issues/29941) <!-- ENGCOM-8209 -->

* `AdminClickInvoiceButtonIntoOrderActionGroup`。 [GitHub-25399](https://github.com/magento/magento2/issues/25399) <!-- ENGCOM-8210 -->

* `AdminGridBulkActionGroup`。 [GitHub-28324](https://github.com/magento/magento2/issues/28324)<!-- ENGCOM-7334 -->

* `AdminGridColumnShowActionGroup`。 [GitHub-28324](https://github.com/magento/magento2/issues/28324)<!-- ENGCOM-7334 -->

* `AdminOpenIndexManagementPageActionGroup`。 [GitHub-29825](https://github.com/magento/magento2/issues/29825) <!-- ENGCOM-8123 -->

* `AdminOpenCatalogSearchTermIndexPageActionGroup`。 [GitHub-29844](https://github.com/magento/magento2/issues/29844) <!-- ENGCOM-8128 -->

* `AdminClickAddProductToggleAndSelectProductTypeActionGroup`。 [GitHub-30917](https://github.com/magento/magento2/issues/30917) <!-- ENGCOM-8439 -->

* `StorefrontCheckoutClickSaveAddressButtonActionGroup`。 [GitHub-30916](https://github.com/magento/magento2/issues/30916) <!-- ENGCOM-8454 -->

* `AdminOpenCurrencyRatesPageActionGroup`。 [GitHub-30783](https://github.com/magento/magento2/issues/30783) <!-- ENGCOM-8432 -->

* `AdminClickGetShippingMethodsAndRatesActionGroup`。 [GitHub-30782](https://github.com/magento/magento2/issues/30782) <!-- ENGCOM-8436 -->

* `AdminSelectFixedShippingMethodActionGroup`。 [GitHub-30782](https://github.com/magento/magento2/issues/30782) <!-- ENGCOM-8436 -->

* `StorefrontClickProceedToCheckoutActionGroup`。 [GitHub-30926](https://github.com/magento/magento2/issues/30926) <!-- ENGCOM-8438 -->

* `StorefrontOpenMyAccountPageActionGroup`。 [GitHub-29842](https://github.com/magento/magento2/issues/29842) <!-- ENGCOM-8143 -->

### ニュースレター

<!-- MC-38789-->

* 管理者ユーザーは、顧客がキュー内のニュースレターを購読する際に、期待どおりに顧客アカウントを編集できるようになりました。 [GitHub-30645](https://github.com/magento/magento2/issues/30645)

<!-- ENGCOM-8034 -->

* 買い物客がニュースレターの購読を確認しなかった場合、アプリケーションはニュースレターの購読確認を再送信するようになりました。 [GitHub-28422](https://github.com/magento/magento2/issues/28422)

<!-- ENGCOM-8429 -->

* 顧客がキュー内のニュースレターを購読した際に、顧客アカウントを期待どおりに編集できるようになりました。 [GitHub-30645](https://github.com/magento/magento2/issues/30645)

### 支払い方法

<!-- MC-35161-->

* マルチストアデプロイメントで想定どおりに、すべての web サイトの支払い方法が管理者に読み込まれるようになりました。

<!-- MC-35152-->

* 買い物客の名前にアクセント付きレターが含まれている場合、アプリケーションは Payflow Pro の支払いを正常に完了するようになりました。 以前は、支払いが完了せず、アプリケーションにこのエラーが記録されていました：`report.CRITICAL: String to be escaped was not valid UTF-8 or could not be converted`。

#### PayPal

<!-- MC-35692-->

* クレジットカードを使用する支払い方法から、クレジットカード以外の支払い方法に切り替えた後、マーチャントは管理者から正常に注文できるようになりました。 以前は、マーチャントが「**注文を送信**」ボタンをクリックすると、読み込みプロセスが開始しても完了せず、注文は行われていませんでした。

<!-- MC-37649-->

* PayPal Express で注文すると、アプリケーションで重複した注文が作成されなくなりました。 以前は、買い物客が PayPal Express で注文の支払いをしようとしたが、PayPal がエラーを返した場合、アプリケーションはまだ注文を作成していました。 その結果、業者のサイトで注文が重複することになりました。 [GitHub-13952](https://github.com/magento/magento2/issues/13952)

<!-- MC-38829-->

* PayPal 決済レポートは、期待どおりに **レポート**/**営業**/**PayPal 決済** で使用できるようになりました。 以前は、アプリケーションは PayPal 決済レポートグリッドにこれらのレポートをリストしておらず、次のメッセージが表示されていました：`We couldn't find any records`。

<!-- MC-39442-->

* チェックアウト中に **PayPal** ボタンをクリックしても、冗長な `web-api` 呼び出しがトリガーされなくなりました。 以前は、2 つのリクエストがトリガーされ、製品の料金が 2 倍になりました。

<!-- ENGCOM-8173 -->

* **顧客グループへの自動割り当て** が有効になっている場合、ゲストの買い物客は PayPal 注文を行えるようになりました。 支払いは PayPal ゲートウェイで処理され、注文はMagentoで作成され、買い物客には注文ありがとうページが表示されます。 以前は、注文は PayPal ゲートウェイで正常に処理されていましたが、注文はMagento Open Sourceで作成されませんでした。 買い物客は代わりに、注文の確認ページにリダイレクトされ、アプリケーションには次のエラーが表示されました。`Failed address validation: %1" error` [GitHub-25399](https://github.com/magento/magento2/issues/25399)

### パフォーマンス

<!-- MC-37705-->

* `module-catalog-import-export/Model/Import/Product/Option.php` のパフォーマンスの問題は解決されました。 10 万件を超えるレコードのエクスポートまたはインポートに要する時間が短縮されました。 ナレッジベースの記事 [ 多数の製品オプションがある場合、読み込み/書き出しに予想以上の時間がかかる ](https://support.magento.com/hc/en-us/articles/360050695772) を参照してください。

<!-- MC-37799-->

* `Magento_Csp/Model/BlockCache` は、メモリ消費と、不必要に大きなキャッシュされた文字列の生成の両方を減らすためにリファクタリングされました。 以前は、動的に許可リストに登録されたスクリプトやスタイルを含むページは、パフォーマンスの問題によって発生することが多くありました。 [GitHub-29964](https://github.com/magento/magento2/issues/29964)

<!-- MC-37816 -->

* コンシューマーを使用した 10 万点以上の商品を含むカタログのスケジュールされたエクスポートのパフォーマンスを向上しました。

<!-- MC-38306 -->

* 無効な製品をカテゴリに追加または保存しても、アプリケーションでカテゴリキャッシュがフラッシュされなくなりました。 以前は、製品ステータスに関わらず、アプリケーションは関連カテゴリのキャッシュをフラッシュしていました。これはサーバーのパフォーマンスに影響を与えました。

<!-- MC-38518 -->

* 買い物かごでの製品数量を更新するためのページ読み込み時間が改善されました。 以前は、アプリケーションは買い物かごで製品ごとに複数の個別のクエリを実行したので、ページの読み込み時間が長くなりました。

<!-- MC-39700 -->

* `Magento_Bulk` MySQL テーブルにインデクサーが追加され、一括操作のパフォーマンスが向上しました。

<!-- MC-38593 -->

* アプリケーションは、設定可能な製品の子 ID をキャッシュするようになりました。 これにより、データベース要求の数が減り、ページ読み込みのパフォーマンスが向上しました。 [GitHub-30585](https://github.com/magento/magento2/issues/30585)

<!-- MC-37594 -->

* 管理ダッシュボードの読み込みが改善されました。 以前は、ページの読み込みが完了する前に、アプリケーションはタブ名をリストとして表示していました。

<!-- MC-37417 -->

* Redis キャッシュ管理は、レイアウトキャッシュの有効期限の制限を追加することで改善されました。 以前は、大規模なデプロイメントで Redis キャッシュが割り当てられた最大メモリにすばやく到達し、アプリケーションが書き込み操作でエラーが発生していました。

<!-- ENGCOM-8016 -->

* `app/code/Magento/Catalog/Model/CategoryLink.php` の冗長データベースクエリの削除により、チェックアウトのパフォーマンスが向上しました。 [GitHub-29453](https://github.com/magento/magento2/issues/29453)

<!-- ENGCOM-8290 -->

* パフォ `Magento\Framework\DB\Adapter\Pdo\Mysql->isTableExists` マンスを向上させるためにリファクタリングが行われました。 テーブルの存在を確認するための `SHOW TABLE STATUS` への冗長な呼び出しが削減されました。 [GitHub-29662](https://github.com/magento/magento2/issues/29662)

<!-- ENGCOM-8258 -->

* `getPageLayoutsConfig` がキャッシュに保存されるようになり、config builder のパフォーマンスが向上しました。 [GitHub-29546](https://github.com/magento/magento2/issues/29546)

### 持続

<!-- MC-36647 -->

* 永続カートが有効な場合、買い物客はセッション cookie の有効期限が切れた後は注文できなくなります。 代わりに、買い物客がログインできるようにログインページが表示されます。 以前は、アプリケーションによって注文が行われていました。 有効期限が切れ、永続的な情報から再作成され `PHPSESSID` ときに、アプリケーションが永続的 `customerSession` 顧客を正しく検証しませんでした。

<!-- MC-39127-->

* 永続買い物かごが有効になっているストアに買い物客がログインした後、アプリケーションに「ようこそ」メッセージが期待どおりに表示されるようになりました。 以前は、アプリケーションに **Not you?ログイン後に** のメッセージが表示されます。

<!-- MC-38269-->

* 「自分ではない **というメッセージが表示されなくなります。永続買い物かごが有効になっているデプロイメントにログインする際に、顧客が** この項目を記憶 **オプションを選択した場合に表示されるテキストを** します。

<!-- MC-37109-->

* 顧客セッションの有効期限が切れると、アプリケーションには顧客の買い物かごの内容が表示されなくなります。 以前は、永続ショッピングカートが有効な場合にゲストのお客様がチェックアウトしようとすると、アプリケーションにこのエラーが表示されていました。`No such entity with cartid = 0`。

### Pricing

<!-- MC-34394-->

* 非同期の価格アップデートが連続して行われても互いに干渉することはなくなり、各オペレーションに正しいステータスが割り当てられます。 以前は、非同期の価格更新が失敗した場合、対応するキューコンシューマーが再起動されるまで、それ以降の非同期の価格更新はすべて失敗していました。 [GitHub-27865](https://github.com/magento/magento2/issues/27865)

### レポート

<!-- MC-36652 38925-->

* **レポート**/**マーケティング**/**買い物かごの製品** に、レポートを生成しているユーザーの許可されたスコープ内のレコードのみが表示されるようになりました。 以前は、すべてのスコープですべてのデータを使用できました。

<!-- MC-38074-->

* 「買い物かごにある製品」レポートに製品通貨を表示する際に、レポートを生成する販売者の役割スコープで指定された通貨が使用されるようになりました。

<!-- MC-37934-->

* 最近表示された項目および最近比較された項目の製品機能で、マルチストアデプロイメントで期待どおりに、管理画面に様々なストアと web サイトの統計が表示されるようになりました。 以前は、これらの機能はすべてのストアや web サイトを考慮に入れていませんでした。

<!-- MC-37217-->

* 注文の価格レポートで、正しい通貨記号が使用されるようになりました。

<!-- ENGCOM-8314 -->

* ユーザーが管理ダッシュボードの「詳細レポートに移動 **ボタンをクリックしたときに、トークンが存在するかどうかをアプリケーションが検証するようにな** ました。  トークンが存在する場合は、アプリケーションに「詳細レポート」ページが表示されます。 トークンが設定されていない場合は、アプリケーションによってユーザーガイドに情報ページが表示されます。 [GitHub-25411](https://github.com/magento/magento2/issues/25411)

### レビュー

<!-- MC-37117-->

* 管理者 **マーケティング**/**すべてのレビュー** の **新しいレビュー** ボタンをクリックすると、新しいレビューページが期待どおりに読み込まれるようになりました。 このページで製品をクリックすると、その製品に対して期待される新しいレビューフォームが開きます。

<!-- ENGCOM-8383 -->

* 管理者 **マーケティング**/**すべてのレビュー** から注文を編集しようとすると、アプリケーションがこのエラーをスローしなくなりました：`Uncaught TypeError: Event.observe is not a function`。  [GitHub-30388](https://github.com/magento/magento2/issues/30388)

### 売上

<!-- MC-36219-->

* `sales_shipment_grid` の `order_created_at` 列が、各更新後に期待どおりに更新されるようになりました。

<!-- MC-36405-->

* カスタムオプションの日付を使用した商品を、**JavaScript カレンダーを使用** が有効になっているストアから正常に並べ替えることができるようになりました。 以前は、並べ替えようとした際に、アプリケーションが買い物かごに項目を追加せず、次のエラーが表示されていました。`Could not add the product with SKU "simp1" to the shopping cart: Please specify date required option(s).`

<!-- MC-36533-->

* 小計ゼロのチェックアウト方法が有効になっているデプロイメントで、買い物客が合計$0 の仮想製品で構成される注文をチェックアウトしても、アプリケーションはすぐに注文をクローズしなくなりました。

<!-- MC-36755-->

* アプリケーションは、処理する前にオーダーをアーカイブしなくなりました。 以前は、管理注文グリッドでの複数選択アクションは、未選択の注文に影響を与えていました。

<!-- MC-37371-->

* サウジアラビア リアル （SAR）が基本通貨として設定されている場合、クレジット メモ グリッドに正しい通貨記号が表示されるようになりました。

<!-- MC-37880-->

* チェックアウト時に、アプリケーションは配送先住所情報を注文ページで期待どおりに表示するようになりました。

<!-- MC-38666-->

* `total_qty` の値が、売上請求書の `total_qty_ordered` の値と一致するようになりました。

<!-- MC-38717-->

* 販売メールの非同期送信で、最終更新日以降に作成された注文に対してのみメールを送信するようになりました。 以前は、非同期送信が有効な場合、アプリケーションは日付でメールをフィルタリングしていませんでした。

<!-- MC-39135-->

* 管理者から注文が行われると、アプリケーションから請求書メールが期待どおりに送信されるようになりました。

<!-- MC-38917-->

* マーチャントが管理者から顧客の新しい注文を作成する際に、セッション中に既存の注文データがクリアされるようになりました。

<!-- MC-38915-->

* **顧客グループへの自動割り当てを有効にする** が有効になっている場合に、管理注文を通じて作成された新規顧客の顧客グループを変更できるようになりました。 VAT 検証に基づいて顧客グループを割り当てることもできます。 以前は、VAT 番号を検証する際に、リクエストオブジェクトが割り当てられたリクエスト `group_id` をチェックしていませんでした。 デフォルトでは、デフォルトの `group_id` が使用されます。

<!-- MC-37539-->

* マーチャントが REST API を使用して部分出荷を作成した後、`Suspected Fraud` のステータスを持つカスタム注文ステータスのステータスが `Processing` に変更されなくなりました。

### 販売ルール

<!-- MC-34793-->

* 配送方法に基づいて適用されたクーポンコードは、買い物客が配送方法を変更した場合に適用されなくなりました。 以前は、買い物客が配送方法を切り替えても、アプリケーションでクーポンコードがクリアされていませんでした。

<!-- MC-34649-->

* 買い物客は、**顧客ごとの使用** 設定で許可されている頻度を超えてクーポンコードを適用することはできません。 以前は、買い物客が複数のブラウザーウィンドウを開いていて、複数の注文を同時に行った場合、**顧客ごとの使用** 設定が **1** であっても、各注文は割引を受けました。

### 検索 {#search-heading}

<!-- MC-35095-->

* 買い物客が検索同義語を検索すると、Elasticsearchが不明な修飾子エラーをスローしなくなりました。 以前は、エスケープするスラッシュ記号が正規表現に含まれていなかったので、致命的なエラーが発生していました。

<!-- MC-37577-->

* 子製品の表示が **個別に表示されない** に設定されている場合、詳細検索で、設定可能な製品の子が個別の検索結果として返されなくなりました。

<!-- MC-37954-->

* 検索結果でElasticsearchの種類の製品名を使用した場合、大文字と小文字が区別されなくなりました。

<!-- ENGCOM-8329 -->

* **キャッシュする上位の検索結果の数を 0 に設定** 設定が、管理者 **ストア**/**設定**/**カタログ**/**カタログ**/**カタログ検索** で有効になっている場合、検索結果ページが期待どおりにキャッシュされるようになりました。

<!-- MC-36807-->

* Elasticsearchフィールドの制限により、カタログ検索インデクサーがエラーをスローせずに実行されるようになりました。 以前は、アプリケーションは次のエラーをスローしていました：`Limit of total fields [xxx] in index [m24dev_product_1_v10] has been exceeded`。

<!-- MC-35491-->

* カタログ検索のパフォーマンスが向上しました。 **検索候補を有効にする** （**Stores**/**Configuration**/**Catalog**/**Catalog Search**）の無効化が期待どおりに動作します。 以前は、アプリケーションはオートコンプリート検索候補のElasticsearchの代わりに MySQL `search_query` テーブルを照会していました。 [GitHub-25534](https://github.com/magento/magento2/issues/25534)

<!-- MC-35256-->

* Elasticsearchは、MySQL と同じ製品価格をフィルタリングするようになりました。 Elasticsearchインデックスのフィールド型 `price_*` を `float` から `double` に変更し、精度を上げて浮動小数点誤差を修正しました。

<!-- ENGCOM-8393 -->

* スラッシュが入力されたときにグローバル検索フォームをアクティブ化するキーダウンイベントリスナーが管理者に追加されました。 [GitHub-29551](https://github.com/magento/magento2/issues/29551)

<!-- MC-24217-->

* `string` 値を使用して `integer` または `decimal` バックエンド型の属性で商品をフィルタリングする場合、Elasticsearchがエラーをスローせず、代わりに商品が期待どおりに表示されなくなりました。 以前は、アプリケーションでは `exception.log`: `number format exception` にこのエラーが表示されていました。

<!-- ENGCOM-8303 -->

* 検索語句に `/` が含まれている場合に、Elasticsearchが例外をスローしなくなりました。  [GitHub-25886](https://github.com/magento/magento2/issues/25886), [GitHub-25110](https://github.com/magento/magento2/issues/25110)

* 一般的なカテゴリ権限の **カタログ検索を許可しない** 設定が有効になっている場合、製品クエリから選択した顧客グループに対して、検索が期待どおりに無効になりました。 [GitHub-29927](https://github.com/magento/magento2/issues/29927)

<!-- ENGCOM-8466 -->

* 検索結果に、同じ単語の複数の引用が含まれなくなりました。 [GitHub-30104](https://github.com/magento/magento2/issues/30104)

### 送料

<!-- MC-38247 -->

* ネットワークの中断によって DHL 配送方法への接続が中断された場合でも、チェックアウトプロセスが失敗しなくなりました。 代わりに、使用可能な他の発送方法が表示されます。 以前は、DHL 配送への接続が中断されるとチェックアウトプロセスが停止し、アプリケーションに「`Sorry, no quotes are available for this order at this time`」というエラーが表示されていました。 [GitHub-29902](https://github.com/magento/magento2/issues/29902)

<!-- MC-35194-->

* 管理者 **ストア**/**設定**/**セールス**/**配信方法** で UPS 配信方法を説明するフィールドが、期待どおりに有効になりました。

<!-- MC-35633-->

* POST`/rest/V1/shipment` エンドポイントを通じて作成された出荷で、注文が正しく更新されるようになりました。 以前は、アプリケーションによって出荷が作成されましたが、出荷ステータスは処理状態のままでした。

<!-- MC-37120-->

* 複数のアドレスに送信してチェックアウトする前に別の製品が買い物かごから削除された場合、アプリケーションは買い物かごから単純な製品を削除しなくなりました。 [GitHub-30259](https://github.com/magento/magento2/issues/30259)

<!-- MC-38031-->

* 注文の確認ページに、複数の住所に出荷される注文の場合と同様に、出荷金額より前の税額が表示されるようになりました。

<!-- ENGCOM-8257 -->

* UPS 出荷の追跡で、パッケージが配達された場合にのみ `Delivered On` のステータスが示されるようになりました。 [GitHub-30032](https://github.com/magento/magento2/issues/30032)

<!-- MC-38825-->

* 複数のアドレスを持つ買い物客が、チェックアウトから買い物かごに戻ったときに、仮想製品を含む注文の正しい買い物かごの小計がアプリケーションに表示されるようになりました。

<!-- MC-38682-->

* JavaScriptのバンドルが有効な場合、FedEx による配送を使用する既存の注文に対して、マーチャントは配送ページから配送ラベルを作成できるようになりました。 以前は、マーチャントが「**配送ラベルを作成**」ボタンをクリックすると、アプリケーションがエラーをスローしていました。

<!-- MC-36953-->

* 顧客に送信される出荷確認メールの出荷トラッキングリンクが期待どおりに機能するようになりました。 以前は、このリンクは 404 エラーを返していました。

<!-- ENGCOM-8025 -->

* 買い物客が複数のアドレスを使用してチェックアウトすると、アプリケーションに情報エラーメッセージが表示され、仮想製品以外のすべての製品が削除されるようになりました。 [GitHub-25595](https://github.com/magento/magento2/issues/25595)

<!-- ENGCOM-8253 -->

* 部分注文で想定どおりに出荷ラベルを作成できるようになりました。 以前は、1 つの注文から 1 つの品目に対してのみ出荷ラベルを作成しようとすると、アプリケーションがすべての製品をパッケージに追加し、検証に失敗していました。 [GitHub-29552](https://github.com/magento/magento2/issues/29552)

<!-- ENGCOM-8154 -->

* `/V1/guest-carts/:cartId/totals-information` を呼び出す際に、発送方法の検証がバイパスされなくなりました。 [GitHub-25147](https://github.com/magento/magento2/issues/25147)

### サイトマップ

<!-- MC-37306-->

* `cron` で生成されるサイトマップに、正しい画像 URL が含まれるようになりました。 以前は、マルチストアのデプロイメントで、生成されたキャッシュ済み画像のパスが正しくありませんでした。

### ストア

<!-- ENGCOM-7543 -->

* 管理者とメインのストア切り替えボタンに、管理者のストアの並べ替え順に対する変更が反映されるようになりました。 [GitHub-13401](https://github.com/magento/magento2/issues/13401)

<!-- ENGCOM-8274 -->

* アプリケーションは、ストアビューのトップレベル URL キーが変更された後で、カテゴリと製品の正しい URL を作成するようになりました。 以前は、ストア表示のカテゴリツリーに変更された `url_keys` が含まれていた場合、カテゴリキーは変更しないがカテゴリの親のキーは変更していた場合、URL を作成するときに、元のコードでカテゴリのデフォルトのストア表示が使用されていました。 [GitHub-28633](https://github.com/magento/magento2/issues/28633)

### ターゲットルール

<!-- MC-34998-->

* 製品の詳細ページの読み込みを最適化しました。 多くの場合にターゲットルールの条件クエリを最適化するデータベーステーブルのインデックスを追加しました。

### 税

<!-- MC-37666-->

* ゲストの注文に対する VAT 検証では、アプリケーションで間違った顧客税クラスの見積もりが保存されなくなりました。 [GitHub-30018](https://github.com/magento/magento2/issues/30018)

<!-- MC-37761-->

* FPT が設定されている場合、チェックアウト時に複数のアドレスに出荷される注文を保存できるようになりました。 以前は、複数のアドレスに対する注文を完了した後、アプリケーションに注文成功ページではなく空白ページが表示されていました。

<!-- ENGCOM-8158 -->

* ストアフロントの製品詳細ページに、新旧の価格が期待どおりに表示されるようになりました。 [GitHub-27500](https://github.com/magento/magento2/issues/27500), [GitHub-11998](https://github.com/magento/magento2/issues/11998)

### テスト

<!-- MC-37364-->

* `bin/magento dev:tests:run` は、all、unit、integration、integration-all、static、static-all、integrity、legacy、default のテストを期待どおりに開始します。

<!-- MC-38488-->

* `AdminMediaGalleryInsertLargeImageFileSizeTest` はリファクタリングされています。

<!-- ENGCOM-8158 -->

* 単体テストは PHPUnit 8 に対応するようになりました。 [GitHub-29779](https://github.com/magento/magento2/issues/29779)

<!-- ENGCOM-8009 -->

* `\Magento\TestFramework\TestCase\WebapiAbstract` には、テストでの期待される結果と実際の結果の大きなネストされた配列の比較をサポートする関数が含まれるようになりました。 結果内の無関係なキーを無視できるようになりました。 [GitHub-29498](https://github.com/magento/magento2/issues/29498)

<!-- ENGCOM-8024 -->

* `AdminMediaGalleryCatalogUiEditCategoryGridPageTest` がランダムに失敗しなくなりました。 [GitHub-1764](https://github.com/magento/adobe-stock-integration/issues/1764)

<!-- ENGCOM-8041 -->

* `dev/tests/integration/testsuite/Magento/Customer/Controller/AccountTest` が改善されました。 （`assert` は、`assertStringContainsString` ではなく `XPath` セレクターに基づいています。） [GitHub-29700](https://github.com/magento/magento2/issues/29700)

<!-- ENGCOM-8017 -->

* `AdminAnalytics` モジュールのテストカバレッジを追加しました。 [GitHub-29500](https://github.com/magento/magento2/issues/29500)

<!-- ENGCOM-8266 -->

* 統合および API 機能テストが PHPUnit 9.3 と互換性を持つようになりました。[GitHub-30146](https://github.com/magento/magento2/issues/30146)

<!-- MC-35798 -->

* GraphQL `testRequestCacheTagsForCategoryListOnMultipleIds` テストの問題を修正しました。 [GitHub-29372](https://github.com/magento/magento2/issues/29372)

<!-- ENGCOM-7762 -->

* URL を含むヘッダー値は、`ApiFunctional TestFramework` で正しく解析されるようになりました。 [GitHub-26425](https://github.com/magento/magento2/issues/26425)

<!-- MC-35798 8109-->

* GraphQL `testRequestCacheTagsForCategoryListOnMultipleIds` テストの問題を修正しました。 [GitHub-29372](https://github.com/magento/magento2/issues/29372)

<!-- ENGCOM-8382 -->

* `mysqldump` のすべてのケースに `—no-tablespaces` が追加されました。これにより、`PROCESS` 権限なしで統合テストを実行できます（MySQL 5.7.31/8.0.21 以降は、デフォルトで `mysqldump` を実行するために必要です）。 [GitHub-30566](https://github.com/magento/magento2/issues/30566)

### テーマ

<!-- ENGCOM-8419 -->

* テーマの親がコンパイルされないようにする新しい `--no-parent` フラグが `bin/magento setup:static-content:deploy` コマンドに追加されました。 この新しいフラグにより、不要なコンパイルを回避して、静的コンテンツのデプロイメントプロセスのパフォーマンスを大幅に向上させることができます。 この新しいフラグは、`compact` 戦略を使用する場合には機能しません。 [GitHub-30184](https://github.com/magento/magento2/issues/30184)

<!-- MC-37630 -->

* デザイン設定で DDL 操作が生成されなくなりました。 以前は、デザイン設定が更新されると、MySQL エラーをトリガーする可能性のある DDL ステートメントが生成されていました。

<!-- ENGCOM-8112 -->

* 管理テーマの `Magento_ConfigurableProduct` モジュールの冗長コードが削除されました。  [GitHub-29857](https://github.com/magento/magento2/issues/29857)

<!-- ENGCOM-8144 -->

* 空白のテーマ内の冗長な LESS スタイルナビゲーションと未使用のプロパティが削除されました。 [GitHub-29914](https://github.com/magento/magento2/issues/29914)

<!-- ENGCOM-8285 -->

* モバイル表示の空白のテーマに折りたたみ可能なナビゲーション機能を追加しました。 [GitHub-30237](https://github.com/magento/magento2/issues/30237)

<!-- ENGCOM-7803 -->

* テーマの web フォントの読み込みを最適化しました。  [GitHub-29526](https://github.com/magento/magento2/issues/29526)

<!-- ENGCOM-8068 -->

* 開発者は、テーマでカスタムフォントを宣言する際に、フォントタイプを指定できるようになりました。 [GitHub-29719](https://github.com/magento/magento2/issues/29719)

### 翻訳とロケール

<!-- MC-36836 -->

* 管理者ロケールがアラビア語（`ar_SA - Saudi Arabia`）の場合、管理者による注文グリッドの日付選択が期待どおりに機能するようになりました。

<!-- MC-38476 -->

* 新しいアドレスを登録または追加する際に、買い物客が有効な郵便番号でアルゼンチンのアドレスを入力しても、アプリケーションにエラーメッセージが表示されなくなりました。 以前は、アプリケーションに次のエラーが表示されていました。`Provided Zip/Postal Code seems to be invalid. Example: 1234. If you believe it is the right one you can ignore this notice.`

<!-- MC-38663-->

* 買い物客が韓国人住所の 5 桁の郵便番号を入力しても、アプリケーションがエラーをスローしなくなりました。

<!-- ENGCOM-8244 -->

* [ISO 3166-2:UY](https://en.wikipedia.org/wiki/ISO_3166-2:UY) で定義されているウルグアイ地域のサポートを追加しました。 [GitHub-29729](https://github.com/magento/magento2/issues/29729)

<!-- ENGCOM-8220 -->

* `zip_codes.xml` は、ブラジルの郵便番号を 8 桁に変換するように更新されました。 [GitHub-29984](https://github.com/magento/magento2/issues/29984)

<!-- ENGCOM-8304 -->

* 残りのローカライズされていないフレーズのローカリゼーションを改善しました。 [GitHub-11175](https://github.com/magento/magento2/issues/11175)

<!-- ENGCOM-8380 -->

* グリッド検索入力プレースホルダーを翻訳できるようになりました。 [GitHub-30510](https://github.com/magento/magento2/issues/30510)

<!-- ENGCOM-8018 -->

* インライン翻訳のJavaScript モジュールが有効な場合にのみダウンロードされるようになりました。  [GitHub-29553](https://github.com/magento/magento2/issues/29553)

### UI

<!-- MC-38509-->

* 新規アカウントを作成ページの **アカウントを作成** ボタンは、買い物客が無効なデータを入力してもアクティブなままです。 以前は、このボタンは無効になっていたため、買い物客はエラーを起こした後にアカウントを作成し直すことができませんでした。 これは 2.4.1 の既知の問題でした。[GitHub-30513](https://github.com/magento/magento2/issues/30513)

<!-- MC-38698-->

* 管理注文の編集ページの配送グリッドの読み込みを改善しました。

<!-- MC-37870-->

* SKU によって製品が買い物かごに追加された場合、アプリケーションには、注文ページで期待どおりに **請求先住所と同じ** チェックボックスが表示されるようになりました。

<!-- ENGCOM-8007 -->

* 制限付きの幅を定義した CSS クラスが、管理 **ストア**/**設定**/**カタログ**/**XML サイトマップ**/**生成設定** の **開始時刻** フィールドに正常に適用されるようになりました。  [GitHub-29496](https://github.com/magento/magento2/issues/29496)

<!-- ENGCOM-7992 -->

* 利用条件チェックボックスラベルの表示の問題を修正しました。  [GitHub-24060](https://github.com/magento/magento2/issues/24060)

<!-- ENGCOM-7948 -->

* 階層価格が使用できない場合、製品ページの階層価格ブロックの CSS コードがアプリケーションに表示されなくなりました。 [GitHub-29194](https://github.com/magento/magento2/issues/29194)

<!-- ENGCOM-8084 -->

* 画像ビューの詳細ページのボタンの位置が、ユーザーインターフェイスのガイドラインに従って並べ替えられました。  [GitHub-1783](https://github.com/magento/adobe-stock-integration/issues/1783)

<!-- ENGCOM-8342 -->

* Internet Explorer/EDGEのブラウザーで、クーポンコードのテキストフィールドが適切な幅で表示されるようになりました。

<!-- ENGCOM-7630 -->

* これで、`@button__border-radius` 変数が `lib/web/css/source/lib/variables/_buttons.less` ライブラリで定義されました。  `border-radius` のデフォルト値は `3px` です。 以前は、`border-radius` はハードコードされていました。  [GitHub-28674](https://github.com/magento/magento2/issues/28674)

<!-- ENGCOM-8067 -->

* ミニ検索フィールドの「検索文字列の長さが検索文字列の最小値に達するまで」検索ボタン（虫眼鏡）が無効になりました。 [GitHub-29704](https://github.com/magento/magento2/issues/29704)

<!-- MC-38807-->

* 「**テンプレートをプレビュー**」ボタンが、キューの編集ページで期待どおりに動作するようになりました。

<!-- MC-31892-->

* あるグループから別のグループに属性を移動しても、アプリケーションで属性の値が保持されるようになりました。

<!-- ENGCOM-8085 -->

* `lib/web/css/source/lib/variables/_typography.less` にフォントウェイト（太い）変数を追加しました。 [GitHub-29778](https://github.com/magento/magento2/issues/29778)

<!-- ENGCOM-8211 -->

* フィルター表示が、管理グリッドで期待どおりに列の表示と連携するようになりました。  [GitHub-30345](https://github.com/magento/magento2/issues/30345)

<!-- ENGCOM-8152 -->

* `this.disabled(true)` を設定すると、UI 選択コンポーネントオプションが表示されなくなりました。 [GitHub-29098](https://github.com/magento/magento2/issues/29098)

<!-- ENGCOM-7901 -->

* `@font-family-name__base` 変数は、Open Sans フォントを読み込む際には使用されなくなりました。 [GitHub-29515](https://github.com/magento/magento2/issues/29515)

<!-- ENGCOM-8120 -->

* WAI-ARIA 属性 `aria-atomic="true"` がエラーコンテナタグに追加されました。 [GitHub-29560](https://github.com/magento/magento2/issues/29560)

<!-- ENGCOM-8175 -->

* UI コンポーネントグリッドに、選択した項目の正確な数が表示されるようになりました。 以前は、キーワードで検索がすべてのグリッド項目を選択し、その後、買い物客がヘッダーチェックボックスを選択する前に一部の項目を選択解除すると、グリッドが誤った選択数を示していました。 [GitHub-29968](https://github.com/magento/magento2/issues/29968)

<!-- ENGCOM-8118 -->

* 請求書ページおよび出荷概要ページに、レンダリングされていないHTMLが表示されなくなりました。 [GitHub-29958](https://github.com/magento/magento2/issues/29958)

<!-- ENGCOM-8066 -->

* 管理 **ストア**/**通貨レート** で「**オプション」をクリックすると、システム設定ページの展開された通貨オプション** セクションに移動するようになりました。 [GitHub-29336](https://github.com/magento/magento2/issues/29336)

<!-- ENGCOM-8361 -->

* ウィジェットのタイプを選択を使用する際に、`adminhtml` のウィジェットの別の条件に応じてウィジェットを表示するサポートが改善されました。 [GitHub-13316](https://github.com/magento/magento2/issues/13316)、[GitHub-7252](https://github.com/magento/magento2/issues/7252)、[GitHub-6868](https://github.com/magento/magento2/issues/6868)

<!-- ENGCOM-8336 -->

* Luma テーマの確認ポップアップダイアログでのテキストのパディングを改善しました。 [GitHub-30452](https://github.com/magento/magento2/issues/30452)

### Vault

<!-- MC-39109-->

* `Vault` モジュールは、支払い情報管理サービスの要求から支払い方法コードを認識するようになりました。 以前は、保存されたBraintreeクレジットカードを使用して買い物客が注文を行った場合、有効な支払い方法が使用されていても、アプリケーションがこのエラーをスローしていました。`The requested Payment Method is not available`。

<!-- ENGCOM-7977 -->

* 管理者ログインの顧客ページにアプリケーションによって表示されるバナーは、ユーザーがスクロールしてもページの上部に残るようになりました。 [GitHub-29354](https://github.com/magento/magento2/issues/29354)

### 頂点

* アドレスの修正時に、アドレス候補が期待どおりに削除されるようになりました。

* 一部のお客様がアカウントパネルにアドレスを保存できなかった競合状態が解決されました。

* 頂点アドレス検証では、特定の条件でアドレス編集ページがフルページキャッシュに追加されなくなりました。

* 頂点計算税は、送料無料が税を含む金額で設定されている場合に考慮されるようになりました。

### Web API フレームワーク

<!-- MC-23904 ENGCOM-8421-->

* POST`V1/invoice/:invoiceId/refund` を使用して、数量がゼロで送料がゼロの請求書を払戻せるようになりました（例：`{"items": [{"qty": 0, "orderItemId": 6, "extensionAttributes": {}}], "appendComment": false, "notify": true, "isOnline": true, "arguments": {"adjustment_negative": 0.0, "adjustment_positive": 0.99, "shipping_amount": 0}}.`）。以前は、次のエラーが発生していました。`You can't create a creditmemo without products` [GitHub-23069](https://github.com/magento/magento2/issues/23069)

<!-- MC-33732 -->

* カテゴリ `V1/categories` を使用して、POSTを作成または更新できるようになりました。 以前は、`default_sort_by` の値が配列として設定されている場合、アプリケーションは値を保存しませんでした。 `default_sort_by` の値が文字列として設定された場合、アプリケーションは次のエラーをスローしました：`Error occurred during \"custom_attributes\" processing. Attribute \"default_sort_by\" has invalid value. The \"string\" value's type is invalid. The \"string[]\" type was expected. Verify and try again.`

<!-- MC-35740 -->

* POST`V1/invoices/:id/capture` を使用して支払い情報を取得する機能が期待どおりに動作するようになりました。 以前は、アプリケーションは注文を承認しましたが、支払いゲートウェイのサイトでのみ注文をキャプチャしました。

<!-- MC-37794 -->

* POST`V1/order/:orderId/ship` を使用して一部の出荷を作成すると、エンドポイントは正しい出荷数を返します。

<!-- MC-38425-->

* POSTを使用して作成された請求書 `V1/order/:orderID/invoice`、店舗クレジットによる一部支払いを正確に反映するようになりました。 以前は、注文の一部がストアクレジットで支払われた場合、ストアクレジットを考慮せずに請求書が作成されていました。

<!-- MC-36830-->

* GET`rest/all/V1/categories` およびGET`rest/all/V1/categories?rootCategoryId=2` 呼び出しで、ツリー内のすべてのカテゴリに対して、入力された `name` フィールドと `product_count` フィールドが期待どおりに返されるようになりました。 以前は、カテゴリフィールドの値は空でした。 テーブル名リゾルバープラグインが、カテゴリ別の製品数を取得するために誤ったテーブル名を返しました。

<!-- ENGCOM-8286 -->

* `save_rewrites_history` カスタム属性が指定された場合、PUT `V1/categories/:id` エンドポイントには、カテゴリ URL キーの 301 リダイレクトの作成に必要なデータが格納されるようになりました。 [GitHub-29174](https://github.com/magento/magento2/issues/29174), [GitHub-30240](https://github.com/magento/magento2/issues/30240)

### ウィッシュリスト

<!-- MC-33626-->

* 買い物客は、商品がカスタムのインベントリソースに割り当てられている場合、ウィッシュリストに商品を追加できるようになりました。 [GitHub-3018](https://github.com/magento/inventory/issues/3018)

<!-- MC-35416-->

* 管理者は、顧客がストアフロントからウィッシュリストに製品を追加した後、管理者の顧客ページから「買い物かごを管理」ページにアクセスできるようになりました。 以前は、管理者が **買い物かごを管理** ボタンをクリックすると、アプリケーションに次のエラーが表示されていました：`An error has occurred. See error log for details`。

<!-- MC-35573-->

* 共有ウィッシュリストページの **買い物かごに追加** ボタンが、ログインしていない匿名、ゲスト、ユーザーに対して期待どおりに動作するようになりました。

<!-- ENGCOM-8062 -->

* ウィッシュリストページで、選択した設定可能な製品属性オプションが、期待どおりに表示されるようになりました。  [GitHub-24091](https://github.com/magento/magento2/issues/24091), [GitHub-22503](https://github.com/magento/magento2/issues/22503)

<!-- ENGCOM-7779 -->

* `\Magento\Wishlist\Controller\Shared\Allcart` に `ActionInterface` を実装しました。 [GitHub-29537](https://github.com/magento/magento2/issues/29537)

## 既知の問題

**問題**:`[magento_root]/index.php` ファイルが削除され、Apache 設定のデフォルトでアプリケーションが `/pub` から実行されるようになりました。 サブフォルダーから提供されるストアは期待どおりに動作せず、404 エラーが表示される場合があります。 **回避策**：シンボリックリンクを使用して、サブフォルダーへのインストールをエミュレートします。 次の例では、`https://shop01.com/shop/` を使用して、シンボリックリンクを使用してサブフォルダーのインストールをエミュレートする方法を示します。

1. `https://shop01.com/shop/` のサブディレクトリを作成します。

   ```bash
   mkdir magento_root/pub/shop01
   ```

   ```bash
   cd magento_root/pub/shop01
   ```

1. 新しく作成したディレクトリに、ストアの親ディレクトリのシンボリックリンクを作成します。

   ```bash
   ln -s ../media media
   ```

   ```bash
   ln -s ../static static
   ```

   ```bash
   ln -s ../../../pub pub
   ```

   ```bash
   ln -s ../.htaccess .htaccess
   ```

   ```bash
   ln -s ../health_check.php health_check.php
   ```

1. 新しいディレクトリ（`magento_root/pub/shop01/index.php`）内に `index.php` ファイルを作成し、次のコンテンツを追加します。

```php
   <?php
   require realpath(__DIR__) . '/../../../app/bootstrap.php';

   switch ($_SERVER['HTTP_HOST']) {
       case 'shop01.com':
       case 'www.shop01.com':
           $params = $_SERVER;
           $params[\Magento\Store\Model\StoreManager::PARAM_RUN_CODE] = 'shop01';
           $params[\Magento\Store\Model\StoreManager::PARAM_RUN_TYPE] = 'website';
           $bootstrap = \Magento\Framework\App\Bootstrap::create(BP, $params);
           $app = $bootstrap->createApplication(\Magento\Framework\App\Http::class);
           $bootstrap->run($app);
           break;

       default:
           $bootstrap = \Magento\Framework\App\Bootstrap::create(BP, $_SERVER);
           /** @var \Magento\Framework\App\Http $app */
           $app = $bootstrap->createApplication(\Magento\Framework\App\Http::class);
           $bootstrap->run($app);
       break;
   }
```

1. 新しいサブディレクトリを指すように Apache サーバーを設定します。 デプロイメントの設定は、大きく異なる場合があります。 サーバー設定の例を次に示します。

```xml
   <VirtualHost *:80>
       DocumentRoot "magento_root/pub/shop1"
       ServerName shop01.com
   </VirtualHost>
```

**問題**：買い物客が最初に支払いページの CAPTCHA フィールドに正しいコードを入力したが、次のエラーが表示される場合、アプリケーションが支払い情報を期待どおりに送信しません。`There has been an error processing your request` これは、買い物客が CAPTCHA コードを入力せずに、または誤って入力して注文を行おうとした場合にのみ発生します。  **回避策**：ページを更新します。<!-- MC-40506-->

**問題**：買い物客が **Venmo で支払う** をクリックすると、アプリケーションは期待どおりにBraintreeで注文を作成しますが、管理者では注文を作成しません。 [2.4.2 の既知の問題：BraintreeVenmo の支払いが機能しない ](https://support.magento.com/hc/en-us/articles/360054662652/) ナレッジベースの記事を参照してください。 <!-- BUNDLE-2894-->

**問題**:Inventory を実行するマルチストアデプロイメントのデフォルト以外のストア表示では、`addConfigurableProductToCart` GraphQL ミューテーションを使用して、設定可能な商品を買い物かごに追加できません。 （Luma ストアフロントは影響を受けません。）アプリケーションに「`Could not add item to cart. Please check required options and try again`」というエラーが表示されます。 **回避策**：代わりに、`addProductsToCart` のミューテーションを使用します。 [GitHub-31660](https://github.com/magento/magento2/issues/31660)<!-- PWA-1298-->

## コミュニティの投稿

より広いMagento Open Sourceコミュニティに感謝し、今回のリリースへの貢献を認めたいと思います。

コミュニティエンジニアリングチーム [ のMagento貢献者 ](https://magento.biterg.io/app/kibana) は、貢献した上位の個人とパートナーのリストを月別、四半期別、年別に管理しています。 その投稿者ページから、GitHub の結合された PR へのリンクをフォローできます。

### パートナーの投稿

次の表に、パートナー様のコントリビューションを示します。 この表は、プルリクエストを行ったパートナー、外部プルリクエスト、それに関連付けられた GitHub 問題番号（利用可能な場合）の一覧です。

{{$include /help/_includes/release-notes/engcomm-2-4-2-partner.md}}

### 個々のコントリビューターの投稿

次の表に、コミュニティメンバーからの投稿を示します。 この表は、外部プルリクエスト、それに関連付けられた GitHub 問題番号（利用可能な場合）、プルリクエストを行ったコミュニティメンバーの一覧です。

{{$include /help/_includes/release-notes/engcomm-2-4-2-issues.md}}

### 必要システム構成

当社の技術スタックは、PHP と MySQL をベースに構築されています。 詳しくは、[ システム要件 ](../../../installation/system-requirements.md) を参照してください。

### インストールとアップグレードの手順

[Composer](../../../installation/composer.md) を使用してMagento Open Source 2.4.2 をインストールできます。

## 移行ツールキット

データ移行ツールは、既存のMagento 1.x ストアデータをMagento 2.x に転送するのに役立ちます。このコマンドラインインターフェイスには、検証、進行状況のトラッキング、ログ記録、テストなどの機能が含まれています。 インストール手順については、[ データ移行ツールのインストール ](../../../tools/data-migration-tool/install.md) を参照してください。 [ データ移行リポジトリ ](https://github.com/magento/data-migration-tool) の調査または貢献を検討します。

[Code Migration Toolkit](https://github.com/magento-commerce/code-migration) は、既存のMagento 1.x のストア拡張機能とカスタマイズ内容をMagento 2.x に転送するのに役立ちます。コマンドラインインターフェイスには、Magento 1.x のモジュールとレイアウトを変換するためのスクリプトが含まれています。

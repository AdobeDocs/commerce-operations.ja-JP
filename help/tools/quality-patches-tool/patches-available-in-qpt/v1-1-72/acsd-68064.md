---
title: ACSD-68064：深くネストされたカテゴリを含む環境のスケジュールされた更新中に、重複エントリが作成される
description: ACSD-68064 パッチを適用すると、Adobe Commerceの問題を修正できます。この問題では、ネストされたカテゴリの数が多い環境でスケジュールされた更新を作成すると、エントリが重複し、カテゴリの保存ができなくなります。
feature: Catalog Management
role: Admin, Developer
type: Troubleshooting
source-git-commit: c7a955e6f9131255420ad0a163e457bd27cfc253
workflow-type: tm+mt
source-wordcount: '393'
ht-degree: 0%

---


# ACSD-68064：深くネストされたカテゴリを含む環境のスケジュールされた更新中に、重複エントリが作成される

ACSD-68064 パッチでは、ネストされたカテゴリの数が多い環境でスケジュールされた更新を作成すると、エントリが重複し、カテゴリの保存ができなくなる問題が修正されています。 このパッチは、[[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) 1.1.72 がインストールされている場合に使用できます。 パッチ ID は ACSD-68064 です。 この問題はAdobe Commerce 2.4.9 で修正される予定であることに注意してください。

## 影響を受ける製品とバージョン

**Adobe Commerce バージョン用のパッチが作成されます。**

* Adobe Commerce（すべてのデプロイメント方法） 2.4.7-p6

**Adobe Commerce バージョンとの互換性：**

* Adobe Commerce（すべてのデプロイメント方法） 2.4.7 - 2.4.7-p7

>[!NOTE]
>
>このパッチは、新しい [!DNL Quality Patches Tool] リリースを含む他のバージョンにも適用される可能性があります。 パッチがAdobe Commerceのバージョンと互換性があるかどうかを確認するには、`magento/quality-patches` パッケージを最新バージョンに更新し、[[!DNL Quality Patches Tool]: Search for patches page](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html) で互換性を確認します。 パッチ ID を検索キーワードとして使用して、パッチを見つけます。

## 問題

ネストされたカテゴリが多数ある環境でスケジュールされた更新を作成すると、エントリが重複し、エラーが発生してカテゴリの保存に失敗します。

<u> 再現手順 </u>:

1. クリーンなインスタンスをインストールします。
1. パフォーマンス器具ファイル（small.xml）を次のように修正します。
   1. **[!UICONTROL Categories]**: *2500*
   1. **[!UICONTROL Products]**: *億ドル*
1. 次のコマンドを使用してデータを生成します。

   ```
   bin/magento setup:performance:generate-fixtures var/performance-toolkit/profiles/ce/small.xml
   ```

1. 製品とカテゴリを作成したら、次のクエリを実行して、すべてのカテゴリがアンカーとして設定されていることを確認します。

   ```
   UPDATE catalog_category_entity_int set value = 1 where attribute_id = (select attribute_id from eav_attribute where attribute_code = 'is_anchor'); 
   ```

1. データを再インデックスします。
1. 管理パネルにログインし、**[!UICONTROL Catalog]**/**[!UICONTROL Categories]** に移動します。
1. **カテゴリ 1** の下の **カテゴリ 2** を移動して、よりネストされた構造を作成します。
1. 深くネストされたカテゴリ（例：**カテゴリ 2.1.1**）に移動します。
1. **[!UICONTROL Scheduled Update]** を作成します。
1. 「**[!UICONTROL Save]**」をクリックします。

<u> 期待される結果 </u>:

カテゴリが正常に保存されました。

<u> 実際の結果 </u>:

エラーが発生し、カテゴリの保存に失敗します。 次 `var/log/exception.log` ようなエラーが含まれています。

```
Exception #0 (Magento\Framework\DB\Adapter\DuplicateException): SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry '229-255' for key 'temp_category_descendants_619aaaaaaaaaa.PRIMARY', query was: INSERT INTO `temp_category_descendants_619aaaaaaaaaa` (`category_id`, `descendant_id`) SELECT `ce`.`entity_id` AS `category_id`, `ce2`.`entity_id` AS `descendant_id` FROM `catalog_category_entity` AS `ce`
 INNER JOIN `catalog_category_entity` AS `ce2` ON ce2.path LIKE CONCAT(ce.path, '/%') OR ce2.entity_id = ce.entity_id AND (ce2.created_in <= '1750287600' AND ce2.updated_in > '1750287600') WHERE ((ce.entity_id IN (4, 6, 7, 8, 10, 24, 25, 27, 30, 33, 34, 35, 36, 37, 40, 41, 42, 43, 44, 48, 51, 54, 56, 57, 59, 60, 63, 64, 65, 66, 67 .......
```

## パッチの適用

個々のパッチを適用するには、デプロイメント方法に応じて、次のリンクを使用します。

* Adobe CommerceまたはMagento Open Source オンプレミス：[[!DNL Quality Patches Tool] > 使用状況 ](/help/tools/quality-patches-tool/usage.md)[!DNL Quality Patches Tool] ガイドに記載されています。
* クラウドインフラストラクチャー上のAdobe Commerce：クラウドインフラストラクチャー上のCommerce ガイドの [ アップグレードとパッチ ](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html)/ パッチの適用」を参照してください。

## 関連資料

[!DNL Quality Patches Tool] について詳しくは、以下を参照してください。

* [[!DNL Quality Patches Tool]: 『ツールガイド』にあるクオリティパッチ ](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) セルフサービスツール。

---
title: 'ACSD-66120: [!DNL GraphQL]  カタログ価格に税が含まれている場合に、誤った割引率と基本価格が表示される'
description: カタログ価格に税が含まれるように設定されている場合に  [!DNL GraphQL]  誤って割引率と基本価格が表示されるAdobe Commerceの問題を修正するために、ACSD-66120 パッチを適用してください。 この問題が原因で、想定される 20% のディスカウントではなく 19.99% のディスカウントが表示されるなど、丸めに関する不一致が発生しました。
feature: GraphQL
role: Admin, Developer
type: Troubleshooting
source-git-commit: 237ec3fb5834b4130eee1ce121dfcd2655c851de
workflow-type: tm+mt
source-wordcount: '500'
ht-degree: 0%

---


# ACSD-66120：カタログ価格に税が含まれている場合、[!DNL GraphQL] に誤った割引率と基本価格が表示される

ACSD-66120 パッチは、カタログ価格が税を含むように設定されてい [!DNL GraphQL] 場合に、割引率と基本価格が誤って表示される問題を修正しました。 この問題が原因で、想定される 20% のディスカウントではなく 19.99% のディスカウントが表示されるなど、丸めに関する不一致が発生しました。 このパッチは、[[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) 1.1.70 がインストールされている場合に使用できます。 パッチ ID は ACSD-66120 です。 この問題はAdobe Commerce 2.4.9 で修正される予定であることに注意してください。

## 影響を受ける製品とバージョン

**Adobe Commerce バージョン用のパッチが作成されます。**

* Adobe Commerce（すべてのデプロイメント方法） 2.4.6-p9

**Adobe Commerce バージョンとの互換性：**

* Adobe Commerce（すべてのデプロイメント方法） 2.4.4 - 2.4.8-p2

>[!NOTE]
>
>このパッチは、新しい [!DNL Quality Patches Tool] リリースを含む他のバージョンにも適用される可能性があります。 パッチがAdobe Commerceのバージョンと互換性があるかどうかを確認するには、`magento/quality-patches` パッケージを最新バージョンに更新し、[[!DNL Quality Patches Tool]: Search for patches page](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html?lang=ja) で互換性を確認します。 パッチ ID を検索キーワードとして使用して、パッチを見つけます。

## 問題

カタログ価格に税が含まれるように設定されている場合、GraphQLで割引率と基本価格が誤って表示される。 丸めエラーにより、割引率は設定済みの 20% ではなく 19.99% と表示されます。

<u> 再現手順 </u>:

1. **[!UICONTROL Stores]**/**[!UICONTROL Settings]**/**[!UICONTROL Configuration]**/**[!UICONTROL Catalog]**/**[!UICONTROL Catalog]**/**[!UICONTROL Price]** に移動します。
1. **[!UICONTROL Catalog Price Scope]** を *Web サイト* に設定します。
1. **[!UICONTROL Stores]**/**[!UICONTROL Settings]**/**[!UICONTROL Configuration]**/**[!UICONTROL Sales]**/**[!UICONTROL Tax]**/**[!UICONTROL Calculation Settings]** に移動します。
   1. **[!UICONTROL Tax Calculation Method Based On]** を *単価* に設定します。
   1. **[!UICONTROL Catalog Prices]** を *税込* に設定します。
   1. **[!UICONTROL Apply Discount On Prices]** を *税込* に設定します。
1. **[!UICONTROL Stores]**/**[!UICONTROL Settings]**/**[!UICONTROL Configuration]**/**[!UICONTROL Sales]**/**[!UICONTROL Tax]**/**[!UICONTROL Default Tax Destination Calculation]** に移動します。
   1. **[!UICONTROL Default Country]** を *フランス* に設定します。
1. **[!UICONTROL Stores]**/**[!UICONTROL Tax Zones and Rates]**/**[!UICONTROL Add new Tax Rate]** に移動します。
   1. **[!UICONTROL Tax Identifier]** フィールドに任意の名前を入力します。
   1. **[!UICONTROL Zip/Post Code]** フィールドにアスタリスク（*）を入力します。
   1. **[!UICONTROL Country]** を *フランス* に設定します。
   1. 「*」フィールドに「* 20.000000 **[!UICONTROL Rate Percent]**」と入力します。
   1. 「**[!UICONTROL Save]**」をクリックします。
1. **[!UICONTROL Stores]**/**[!UICONTROL Tax Rules]**/**[!UICONTROL Add New Tax Rule]** に移動します。
   1. **[!UICONTROL Name]** フィールドに任意の名前を入力します。
   1. 前の手順で追加したレートに **[!UICONTROL Tax Rate]** を設定します。
1. **[!UICONTROL Catalog]**/**[!UICONTROL Products]**/**[!UICONTROL Add Product]** に移動します。
   1. *フィールドに* test **[!UICONTROL Product Name]** と入力します。
   1. *フィールドに* test **[!UICONTROL SKU]** と入力します。
   1. 「**」フィールドに** 82.65 **[!UICONTROL Price]** と入力します。
   1. 「**[!UICONTROL Tax Class]**」を「*課税品*」に設定します。
   1. 「*」フィールドに* 100 **[!UICONTROL Quantity]** と入力します。
   1. 「**[!UICONTROL Save]**」をクリックします。
1. 範囲を *デフォルトのストア表示* に変更します。
   1. [ 価格 ] の **[!UICONTROL Use Default Value]** をオフにします。
   1. **[!UICONTROL Price]** を *68.87* に設定します。
   1. 税クラスの **[!UICONTROL Use Default Value]** の設定を解除します。
   1. **[!UICONTROL Tax Class]** を *課税品* に設定します。 
   1. 「**[!UICONTROL Save]**」をクリックします。
1. **[!UICONTROL Marketing]**/*[!UICONTROL Promotions]*/**[!UICONTROL Catalog Price Rule]**/**[!UICONTROL Add New Rule]** に移動します。
   1. **[!UICONTROL Rule Name]** フィールドに任意の名前を入力します。
   1. **[!UICONTROL Active]** を *はい* に設定します。
   1. **[!UICONTROL Website]** を *メイン Web サイト* に設定します。
   1. **[!UICONTROL Customer Groups]** を *all* に設定します
   1. 「**[!UICONTROL Actions]**」で、「**[!UICONTROL Apply]**」を *オリジナルに対する割合で適用* に設定します。
   1. 「*」フィールドに「* 20.000000 **[!UICONTROL Discount Amount]**」と入力します。
   1. 「**[!UICONTROL Save]**」をクリックします。
1. 完全な再インデックスを実行します。

```
$ bin/magento index:reindex
```

1. [!DNL GraphQL] を使用して、次の **[!UICONTROL Store]** クエリを実行します。*default* ヘッダーに設定されています。

```
query{
products(filter: {sku: {eq: "test"}}, sort: {name: ASC}) {
    items {
      name
      sku
      price_range {
        minimum_price {
          regular_price {
            value
            currency
          }
          final_price {
            value
            currency
          }
          discount {
            amount_off
            percent_off
          }
        }
        maximum_price {
          regular_price {
            value
            currency
          }
          final_price {
            value
            currency
          }
          discount {
            amount_off
            percent_off
          }
        }
      }
    }
  }
}
  
```

<u> 期待される結果 </u>:

割引率は、カタログルールの 20% と一致する必要があります。

<u> 実際の結果 </u>:

割引率が誤って 19.99% と表示されます。

## パッチの適用

個々のパッチを適用するには、デプロイメント方法に応じて、次のリンクを使用します。

* Adobe CommerceまたはMagento Open Source オンプレミス：[[!DNL Quality Patches Tool] > 使用状況 &#x200B;](/help/tools/quality-patches-tool/usage.md) [!DNL Quality Patches Tool] ガイドに記載されています。
* クラウドインフラストラクチャー上のAdobe Commerce：クラウドインフラストラクチャー上のCommerce ガイドの [&#x200B; アップグレードとパッチ &#x200B;](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html?lang=ja)/ パッチの適用」を参照してください。

## 関連資料

[!DNL Quality Patches Tool] について詳しくは、以下を参照してください。

* [[!DNL Quality Patches Tool]: 『ツールガイド』にあるクオリティパッチ &#x200B;](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) セルフサービスツール。

---
title: 詳細設定
description: 大量のデータを処理する大規模なエンタープライズシステムに関するベストプラクティスと推奨事項の確認
source-git-commit: 9ab52374e031bd2b0a846dd5f47c89ff788dcafa
workflow-type: tm+mt
source-wordcount: '1203'
ht-degree: 0%

---


# 詳細設定

[!DNL Commerce] は、あらゆる規模の商人向けのソリューションを含む、非常に柔軟で拡張性の高い製品です。 この節では、設定に関するベストプラクティスと推奨事項を説明します [!DNL Commerce] 大量のデータ、極端な負荷、その他のエンタープライズケースを処理する場合。

## インデックスのパフォーマンスの較正

大量のデータを扱う場合、インデックスの再作成が問題になる可能性があります。 この [!DNL Commerce] チームは、最も読み込まれたインデックスを選択し、バッチインデックスを有効にしました。これにより、各反復で処理するデータの一部を設定できます。 これにより、データベース内のデータのタイプとサイズに基づいてバッチサイズを調整できます。

この設定を管理するには、 `batchRowsCount` パラメーター `di.xml` 対応するモジュールのファイル。 この機能は次のインデックスでサポートされています。

* カテゴリ製品インデックス（カタログモジュール）
* 価格指数（カタログモジュール）
* EAV インデックス（カタログモジュール）
* 在庫インデックス（CatalogInventory モジュール）

インデックスのバッチサイズ変数を調整することで、インデクサーのパフォーマンスを調整できます。 インデクサーによって一度に処理されるエンティティの数を制御します。 状況によっては、インデックス作成時間が大幅に短縮されることがあります。

例えば、B2B メディアと同様のプロファイルを実行している場合、設定値を上書きできます `batchRowsCount` in `app/code/Magento/catalog/etc/di.xml` のデフォルト値を上書きします。 `5000` から `1000`. これにより、デフォルトでは、インデックス作成の全時間が 4 時間から 2 時間に短縮されます [!DNL MySQL] 設定。

>[!NOTE]
>
>カタログルールインデクサーのバッチ処理が有効になっていません。 多数のカタログルールを持つマーチャントは、調整が必要です [!DNL MySQL] インデックス作成時間を最適化する設定 この場合、 [!DNL MySQL] 設定ファイルを使用し、TMP_TABLE_SIZE とMAX_HEAP_TABLE_SIZE の設定値にメモリを割り当てると、このインデクサのパフォーマンスが向上しますが、結果として [!DNL MySQL] より多くの RAM を消費している。

### Web サイト別に顧客グループと共有カタログを制限

多数の製品 SKU、Web サイト、顧客グループ、共有カタログは、製品価格およびカタログルールのインデクサーの実行時間に影響します。 これは、デフォルトでは、すべての Web サイトがすべての顧客グループ（共有カタログ）に割り当てられるからです。

インデックス作成時間を短縮するには、 [特定の Web サイトを顧客グループから除外（共有カタログ）](https://devdocs.magento.com/guides/v2.4/extension-dev-guide/indexer-optimization.html#customer-group-limitations-by-websites).

## Redis の設定

時には、1 つの Redis インスタンスが受信要求を処理するのに十分でないことがあります。 この状況に対処することをお勧めするソリューションがいくつかあります。

まず、 [!DNL Commerce] では、キャッシュタイプごとに別々のキャッシュストレージを設定できます。 これにより、Magentoに登録されているキャッシュの種類と同じ数の Redis インスタンスを個別にインストールできます。 現実的には、設定、レイアウト、ブロックなど、最もアクティブに使用されるキャッシュに対して Redis インスタンスが必要になる場合があります。

別の解決策として、設定キャッシュをファイルシステム上に配置し、他のキャッシュを Redis サーバに移動する方法があります。 このソリューションでは、すべての Web ノードで設定キャッシュを一元的に無効化する個別のツールが必要です。

また、自動的に増加するノード数で並列読み取り/書き込み操作を実行する Redis クラスタを使用することもできます。 [!DNL Commerce] ではこの場合の設定は提供されていませんが、小規模なカスタマイズを使用して起動できます。

## 設定 [!DNL RabbitMQ]

Magento Open SourceとAdobe [!DNL Commerce] が実装したメッセージキューをサポート [!DNL RabbitMQ]. [!DNL Commerce] は、B2B カタログ操作や非同期在庫更新など、多数の非同期操作を実行するために、このサービスを使用します。 ジョブサーバーにジョブを追加するためのすべてのインターフェイスは、製品と共に配布され、サードパーティの拡張機能の範囲で、カスタムの非同期ロジック実装に使用できます。 他の統合と同様に、 [!DNL Commerce] には、のサンプル設定ファイルが用意されています。 [!DNL RabbitMQ] これにはすべての推奨設定が含まれ、実稼動環境での使用の準備が完了しています。

## データベースを分割

>[!WARNING]
>
>データベース分割機能は次のとおりです。 [非推奨](https://community.magento.com/t5/Magento-DevBlog/Deprecation-of-Split-Database-in-Magento-Commerce/ba-p/465187) (Adobe Commerceのバージョン 2.4.2)。 詳しくは、 [分割データベースから単一のデータベースに戻す](https://devdocs.magento.com/guides/v2.4/config-guide/revert-split-database.html).

Adobe Commerceでは、ビジネスの成長に伴うニーズに合わせて拡張性の高いデータベースストレージを構成できます。 特定のドメインを扱う 3 つの異なるマスターデータベースを設定できます。

* メイン（カタログ）データベース
* チェックアウトデータベース
* Order Management System (OMS) データベース

追加のデータベースを設定するには、空のデータベースを作成し、次のいずれかのコマンドを実行する必要があります。

チェックアウトマスターDB

```bash
bin/magento setup:db-schema:split-quote
```

OMSマスターDB 用

```bash
bin/magento setup:db-schema:split-sales
```

これらのコマンドを使用すると、特定のドメインテーブルがメインデータベースからドメインデータベースに移行されます。 また、 [!DNL Commerce] 対応する接続と制約の処理を許可する設定

チェックアウトと Order Management 用に別々のデータベースを用意することで、データベースサーバー間で負荷を分散できます。 カタログやその他の操作の可用性に影響を与えることなく、1 秒あたり多くのチェックアウトを提供し、より多くの注文を処理できます。 フラッシュまたはアクティブな販売期間にデータベースを分割するか、または通常の高負荷プロジェクトに対して永続的に使用することをお勧めします。 データベース間での現在のデータの移行は、システム管理者の監視下で実行する必要があります。  実稼動モードの間は、データベースを分割しないでください。

マスター・データベースに加えて、 [!DNL Commerce] では、多数のスレーブデータベースを設定できます（システムで宣言されているデータリソースごとに 1 つ）。 スレーブデータベースは、メインデータベースのフルレプリカ、またはドメインマスターデータベースの 1 つとして機能します。 特定のリソースに対する読み取り操作用に発行されます。

次のコマンドを実行して、スレーブデータベースを追加できます。

```bash
bin/magento setup:db-schema:add-slave
```

このコマンドは、設定の変更を実行しますが、レプリケーション自体は設定しません。 それは手動で行う必要があります。

マスター・データベースを分割し、スレーブ・データベースを設定した後、 [!DNL Commerce] は、特定のデータベースへの接続を自動的に規制し、リクエストのタイプ (POST、PUT、GETなど ) とデータリソースに基づいて判断を下します。 If [!DNL Commerce] または、拡張機能がGETリクエストに対して書き込み操作を実行すると、接続がスレーブデータベースからマスターデータベースに自動的に切り替えられます。 マスターデータベースでも同じように機能します。チェックアウト関連のテーブルを操作すると、すべてのクエリが特定のデータベースにリダイレクトされます。 一方、カタログ関連のクエリはすべてメインデータベースに送られます。

設定の詳細と複数のマスター/スレーブ設定の利点については、
[分割データベースパフォーマンスソリューション](https://devdocs.magento.com/guides/v2.4/config-guide/multi-master/multi-master.html).

## メディアコンテンツを提供

Magentoは、メディアコンテンツを提供および配信するための特定の統合を提供しません。 すべての一般的なアプローチをMagentoで併用できます。

メディアコンテンツを配信およびキャッシュするのが最も簡単な方法です。 [!DNL Varnish] サーバー。 この方法では、メディアコンテンツを保存する共有ファイルシステム、または [!DNL Varnish].

中負荷および高負荷の環境の場合は、Fastly、Akamai などのコンテンツ配信ネットワーク (CDN) サービスを使用することをお勧めします。 これらのサービスを使用する場合、 [!DNL Commerce] は、コンテンツの更新に従来のプルアプローチを使用します。 次を設定する必要があります： [!DNL Commerce] 対応する CDN サービスと連携するための URL。 メディアコンテンツを CDN に移動することで、インスタンスの負荷を大幅に軽減できます。

## ログストレージの設定

ログのストレージと、そのログが他のディスク操作に与える影響は、特に高負荷の状況での Web ノードの可用性に影響します。 不要な場合は、ログを最小限に抑えることをお勧めします。 また、高アクセス速度の別のストレージシステムに書き込むようにログを構成することもできます。 ログストレージへのアクセスに関するボトルネックは、フローの一部として書き込み操作または読み取り操作を記録する受信要求の処理に直接影響を与える可能性があることに注意してください。

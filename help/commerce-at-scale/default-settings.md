---
title: デフォルト設定の変更
description: Adobe Experience ManagerをCMSとして使用するように、Adobeコマースプロジェクトを準備するには、いくつかのデフォルト設定を変更します。
source-git-commit: 1cff7359ddb4caeca6773ff74b92048c89676f12
workflow-type: tm+mt
source-wordcount: '1218'
ht-degree: 0%

---


# デフォルトのAdobeコマース設定の変更

## AEMおよびAdobeコマースインフラストラクチャの地理的な場所

ページの構築時にAEMパブリッシャーとAdobeCommerce GraphQLの間の待ち時間を短縮するには、2つの異なるインフラストラクチャの初期プロビジョニングを同じAWS（またはAzure）リージョン内でホストする必要があります。 また、両方のクラウド用に選択する地理的な場所は、ほとんどの顧客ベースに最も近い場所である必要があります。そのため、クライアント側のGraphQL要求は、地理的に近い場所から大部分の顧客に提供されます。

## AWS/Azure PrivateLink — クラウドVPC上でAEMとAdobeコマースをリンク

応答時間を短縮し、負荷が大きいサイトでの待ち時間をさらに短縮するために、AEM VPCとクラウドのVPC上のAdobeコマースの間でAWS（またはAzure）Privatelink接続を考慮できます。 これにより、AEMパブリッシャーとAdobeコマース間のすべてのネットワークトラフィックがグローバルAWSバックボーンに残り、パブリックインターネットを経由する必要がなくなります。

## AdobeコマースのGraphQLキャッシュ

ユーザーのブラウザーまたはAEMパブリッシャーがAdobeコマースのGraphQLを呼び出すと、特定の呼び出しがキャッシュされます
精霊の中に キャッシュされるクエリは、通常、個人データ以外を含み、頻繁に変更されないクエリです。 次に例を示します。categories、categoryListおよびproducts。 明示的にキャッシュされないものは、定期的に変更され、キャッシュされている場合、買い物かごやcustomerPaymentTokensなどのクエリなどの個人データやサイト運用にリスクが生じる可能性があるものです。

GraphQLでは、1回の呼び出しで複数のクエリを実行できます。 1つのクエリでも、Adobeコマースでキャッシュできない他の多数のクエリがキャッシュされないことを指定すると、Adobeコマースは呼び出しのすべてのクエリのキャッシュをスキップすることに注意してください。 これは、複数のクエリを組み合わせる場合に開発者が考慮する必要があります。これにより、キャッシュ可能なクエリが意図せずバイパスされることが‡ではなくなります。

>[!NOTE]
>
> キャッシュ可能なクエリとキャッシュ不可なクエリについて詳しくは、Adobeコマース[開発者向けドキュメント](https://devdocs.magento.com/guides/v2.4/graphql/caching.html)を参照してください。

## カタログフラットテーブル

製品やカテゴリに対してフラットテーブルを使用することはお勧めしません。 この非推奨（廃止予定）の機能を使用すると、パフォーマンスの低下やインデックス作成の問題が発生する可能性があるので、ストアフロントセクションのAdobeコマース管理でフラットカタログを無効にする必要があります。 サードパーティのモジュールやカスタマイズの中には、フラットテーブルが正しく機能する必要があるものもあります。フラットテーブルを使用する際の影響やリスクを理解するために、評価を行うことをお勧めします。

## 精密な原点遮蔽

既定では、Fastlyオリジンシールドは有効になっていません。 Fastlyの接触チャネルシールドの目的は、Adobe商取引所への直接のトラフィックを減らすことです。リクエストを受け取ると、Fastlyエッジの場所（または「POP」）がキャッシュされたコンテンツを確認し、提供します。 キャッシュされない場合は、シールドPOPを続行して、そこにキャッシュされているかどうかを確認します（以前に他のグローバルPOPからコンテンツが要求された場合は、キャッシュされます）。 最後に、Shield POP上でキャッシュされていない場合は、Originサーバに進みます。

Fastlyオリジンシールドは、Adobeコマース管理Fastly設定バックエンド設定で有効にできます。 最高のパフォーマンスを得るには、Adobeコマース元のデータセンターに最も近いシールドの場所を選択する必要があります。

## Fastly画像の最適化

Fastlyオリジンシールドが有効になると、Fastly Image Optimizerも有効になります。 このサービスは、Adobeコマースに商品カタログ画像を格納する場合、AdobeコマースのオリジンからFastlyに、すべてのリソースを集中的に使用する商品カタログ画像変換処理の負荷を軽減します。 また、Adobeコマース元に戻るリクエストの数を減らすことで待ち時間をなくすエッジの場所で画像が変換されるので、エンドユーザーのページ読み込み時間の応答時間も改善されます。

Fastly画像の最適化は、オリジンシールドが有効化された後にのみ、管理のFastly設定で「ディープ画像の最適化を有効にする」ことで有効にできます。 Fastly画像の最適化の設定に関する詳細は、Adobeコマースの[開発者向けドキュメント](https://devdocs.magento.com/cloud/cdn/fastly-image-optimization.html)を参照してください。

![コマース管理でのFastly画像の最適化設定のスクリーンショットAdobe](../assets/commerce-at-scale/image-optimization.svg)

## 未使用のモジュールの無効化

Adobeコマースヘッドレスを実行している場合、GraphQLエンドポイントを介した要求のみ、フロントエンドストアページを介した要求は提供されず、Adobeコマースから直接提供されると、多くのモジュールが冗長になり、使用されなくなります。 未使用のモジュールを無効にすると、Adobeコマースコードベースが小さくなり、複雑さが軽減され、パフォーマンスが向上します。 Composerを使用して、Adobeコマースでのモジュールの無効化を管理できます。 無効にできるモジュールは、サイトの要件に応じて異なるので、各顧客のAdobeコマースの実装に固有の推奨リストは提供されません。

## MySQLとRedisの接続の有効化

デフォルトでは、MySQLとRedis Slaveの接続は、クラウド上のAdobeコマースでは有効になりません。 これは、これらの設定が、非常に高い負荷を予想するお客様にのみ適しているためです。 スレーブ接続を有効にすると、Cross-AZ（クロスアベイラビリティゾーン）の待ち時間が長くなるので、この設定は、インスタンスが通常の負荷レベルのみを受け取る場合に、クラウドインスタンス上のAdobeコマースのパフォーマンスを実際に低下させます。

Adobeコマースインスタンスが極端な負荷を予期している場合は、MySQLとRedisのマスタースレーブをアクティブ化すると、MySQLデータベースの負荷を異なるノードに分散させ、パフォーマンスが向上します。

ガイドとして、通常の負荷がかかる環境では、スレーブ接続を有効にすると、パフォーマンスが10～15%低下します。 しかし、負荷とトラフィックが大きいクラスターでは、パフォーマンスが約10～15%向上します。 したがって、期待されるトラフィックレベルで環境をロードテストし、負荷時のパフォーマンスにこの設定が役立つかどうかを評価することが重要です。

mysqlとredisのスレーブ接続を有効/無効にするには、`.magento.env.yaml`ファイルを編集して次の情報を含める必要があります。

```
stage:
  deploy:
    MYSQL_USE_SLAVE_CONNECTION: true
    REDIS_USE_SLAVE_CONNECTION: true
```

拡張アーキテクチャ（分割アーキテクチャ — 以下を参照）の場合、Redisスレーブ接続を有効にしないでください。有効にすると、エラーが発生します。 分割アーキテクチャの場合は、代わりにRedis用のL2キャッシュを実装することをお勧めします。

## クラウド規模の（分割）アーキテクチャでのAdobeコマースへの移行

上記のすべての構成の後で、負荷テストの結果またはライブインフラストラクチャのパフォーマンスの分析が、Adobeコマースの負荷レベルがCPUや他のシステムリソースを一貫して最大限に引き出すレベルであることを示している場合は、スケール（分割）アーキテクチャへの移行を検討する必要があります。

標準のProアーキテクチャでは、3つのノードがあり、各ノードには完全なテクニカルスタックが含まれます。 分割層アーキテクチャに変換すると、次の変更が6ノード以上になります。そのうち3つは、Elasticsearch、マリアDB、レディス、その他のコアサービスを含む。webトラフィックを処理する他の3は、phppmとNGINXを含みます。 分割層を使用すると、より大きな拡張性を実現できます。データベースを含むコアノードは、垂直方向にスケールできます。webノードは、水平および垂直に拡張でき、高い負荷アクティビティの設定期間に対して、インフラストラクチャをオンデマンドで拡張する柔軟性が大きく、追加のリソースが必要なノード上でも大幅に高くなります。

サイトに対する負荷の高い予想が原因で、分割層アーキテクチャに切り替えることを決定した場合は、これを有効にする手順について、カスタマーサクセスマネージャーにディスカッションを行う必要があります。
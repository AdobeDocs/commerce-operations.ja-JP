---
title: パフォーマンステストのヒント
description: Adobe CommerceおよびAdobe Experience Managerソリューションを起動するための KPI の設定方法を説明します。
exl-id: 4b0d9c4f-e611-452d-a80f-27f82705935d
source-git-commit: e76f101df47116f7b246f21f0fe0fa72769d2776
workflow-type: tm+mt
source-wordcount: '1147'
ht-degree: 0%

---

# パフォーマンステストのヒント

上記のすべての変更の有効性を評価するには、運用を開始する前、および実稼動環境への今後の大規模なデプロイメントの前に、徹底したパフォーマンステストを実行する必要があります。 負荷テストを計画する際は、できる限り実際の消費者トラフィックをシミュレートすることが重要です。

AEM/CIF/Adobe Commerceサイトで最もリソースを消費する領域は、チェックアウトプロセスやサイト検索など、キャッシュできない領域です。 通常、e コマースサイトへのトラフィックの大部分は静的で、したがって、キャッシュ可能です（PDP や製品リストページの場合など）。そのため、テストのスクリプトやシナリオは、プラットフォームの制限を測定するためにそれを反映します。

読み込みテスト用に 1 つのスクリプトを実行して、ステップ間の待ち時間なしでサイトを移動し、毎回チェックアウトプロセスを完了すると、実際のシナリオとは異なり、プラットフォームの制限を確実に示すことはできません。

KPI の定義は、パフォーマンステスト計画の最初のステップです。初期テスト中にテストできるが、将来、また、サイトの運用開始後に定期的に測定できる指標を定義する。 これにより、サイトのパフォーマンスを経時的に追跡できます（運用開始前後）。 定義する KPI の例を次に示します。

- 平均応答時間 — 最初のバイトまたは最後のバイトまでの時間
- 遅延
- バイト/秒（スループット）
- エラー率
- 1 時間あたりの購入回数
- 1 時間あたりのページビュー数
- 1 時間あたりのユニークユーザー数（同時買い物客数）

## JMETER のガイドライン

AEM/CIF/Adobe Commerceの負荷テストを開発する際は、次の Jmeter の大まかなガイドラインを考慮する必要があります。

- スクリプトを設定可能なシナリオに分割します。次に例を示します。
   - ホームページを開く
   - カテゴリページを開く (PLP)
   - PDP(Simple Products) の表示 — 各反復で 2 つのループ
   - 設定可能な製品の表示 — 各反復で 2 つのループ
      - 例えば、上記の手順をトラフィックの 60%に設定します
   - 製品検索
      - 例えば、カタログ検索をトラフィックの 37%に設定します。
   - 買い物かごとチェックアウト
      - 例えば、ユーザーが買い物かごとスクリプトのチェックアウト部分に入力した場合、デフォルトでは、業界標準の e コマースサイトコンバージョン率が約 3%に設定されます
      - チェックアウトフローはキャッシュされず、通常はリソースを大量に消費する操作なので、注文を完了する人の数とサイトブラウザーの数を比較的高い数値に設定すると、サイトで処理できるトラフィック量の信頼できない結果になります。
- 各テストが実行される前に、すべてのキャッシュを消去します。
   - AEM Dispatcher キャッシュが完全にクリーンアップされる必要があります
   - Adobe Commerceの Fastly および内部キャッシュは、完全にフラッシュしてクリーンアップする必要があります。これは、Adobe Commerce管理のキャッシュコントロールでおこなえます。
- Jmeter テストにランプ期間を含める：ランプ期間が設定されていない場合、トラフィックが徐々に増加することはなく、サイトがページの一般的に訪問されるページやコンポーネントをキャッシュする機会もなくなります。 実際には、すべてのピークトラフィックが完全にキャッシュされていないサイトに同時に到達することは珍しいことです。したがって、実際の e コマースサイトで発生するようにキャッシュを構築できるように、Jmeter テストスクリプトにランプ期間を含める必要があります。
- 繰り返し内の各ステップ間の「待機時間」を使用する必要があります。実際には、ジャーニー中にユーザーがサイト上の次のページにすぐにジャンプすることはありませんでした。ユーザーがページを読んで次のアクションを決定する間、待機時間があります。
- スレッドグループを無限にループするように設定し、x （例：60 分）の設定時間に対しては、前回のテスト実行と同等の応答時間の中央値を持つ、繰り返し可能なテストを行います。 つまり、設定ランプアップ期間の後に、同時に実行する仮想ユーザのターゲット数が存在し、設定ループ時間が継続します。
- 中央値時間は、平均ではなく平均応答時間の改善/減少を与えるために使用する必要があります。 他の結果よりも長いエッジの結果が複数ある場合、これは、この平均結果をゆがめますが、大多数のユーザーに対するエンドユーザーの応答時間に関心があることは、中央値の測定により適しています。
- 埋め込みリソースは、デフォルトでは jmeter では収集されません（例：実際のユーザーがページを訪問したときにダウンロードされた JS、CSS、その他のリソース）。 これは有効にできますが、テストしているドメインに対してのみ、外部のリソース呼び出しは除外する必要があります（例：外部でホストされているサービスからの応答時間を含めない場合など）。 google analytics コードで使用できます（制御できないので）。
- HTTP キャッシュマネージャーを有効にする必要があります。これにより、Jmeter は、自分のブラウザーで Web サイトを閲覧中に実際のユーザーのジャーニーと同じように、ジャーニー中にページ要素をキャッシュできます。 サイトを経由したジャーニーの間、ユーザーのブラウザーは、関連する埋め込みリソースを 1 回だけダウンロードし、その後、ユーザーのブラウザーによってキャッシュされます。 また、元の訪問の後しばらくして同じユーザーがサイトに戻った場合でも、それらのアセットがキャッシュされるキャッシュである可能性があります。
- リスナーは、実際の負荷テスト実行内（「結果ツリーの表示」や「集計レポート」など）に保持する必要があります。 非 GUI の実負荷テスト実行にこれを含めると、実際のテスト実行中にレポートを生成するためにリソースが使用されるので、Jmeter が報告するパフォーマンスの結果に影響を与える可能性があります。 これらのリスナーは、テストスクリプトから削除され、JTL 結果ファイルに置き換えられました。JTL 結果ファイルは、Jmeter の Report Dashboard 機能を使用して処理できます。
- ダッシュボードレポートの「Apdex スコア」を使用して、テスト実行間のパフォーマンスに対する変更の影響をすばやく測定できるように、評価の対象となる応答時間を指定します。 Apdex スコアは、許容可能な時間内にサイトにアクセスできる一定の人数に基づきます。 応答時間が一定の「不満」を超えると、スコアが下がります。 時刻は、「apdex_satified_ threshold」および「apdex_toluted_threshold」パラメーターを使用して設定できます。
- 仮想ユーザー数ではなく、ビジネスユーザーに提示するターゲット「1 時間あたりの注文件数」指標を設定します。 「仮想ユーザー」は、テストが何を測定しているかを理解するための複雑なトピックになる場合があります。 サイトのコンバージョン率、1 時間あたりの購入回数、平均時間を計算し、各ページの読み込み間隔を考えることで、業界標準の計算を使用して、達成すべき 1 時間あたりの購入回数に基づく異なる負荷テストシナリオを示すことができます。
- 最後に、Jmeter テストサーバーは、ユーザートラフィックの大部分が入ってくる場所と、クラウドインフラストラクチャがホストされている場所に地理的に近いサーバーで実行する必要があります。これらが同じであれば幸いです。

---
title: パフォーマンスの最適化Recommendations
description: 次の推奨事項に従って、Adobeコマース実装のパフォーマンスを最適化します。
source-git-commit: 748c302527617c6a9bf7d6e666c6b3acff89e021
workflow-type: tm+mt
source-wordcount: '1287'
ht-degree: 0%

---


# パフォーマンス最適化のレビュー

パフォーマンスの最適化は多くの側面から得られる場合でも、ほとんどのシナリオで考慮する必要がある一般的な推奨事項がいくつかあります。 これには、インフラストラクチャ要素の構成の最適化、Adobe・コマースのバックエンド構成、アーキテクチャ拡張性の計画が含まれます。

## インフラ

次の節では、インフラストラクチャの最適化に関する推奨事項を説明します。

### DNS 検索

DNS 検索は、ドメイン名が属する IP アドレスを検索するプロセスです。 ブラウザーは、DNS 参照が完了するまで待ってから、各要求の内容をダウンロードする必要があります。 DNS 検索を減らすことは、ページ全体の読み込み時間を改善するために重要です。

### コンテンツ配信ネットワーク (CDN)

CDN を使用して、アセットのダウンロードパフォーマンスを最適化する。 Adobeコマースは Fastly を使用します。 オンプレミスでのAdobeコマース実装がある場合は、CDN レイヤーの追加も検討する必要があります。

### Web 遅延

データセンターの場所は、フロントエンドユーザーの Web 遅延に影響します。

### ネットワーク帯域幅

十分なネットワーク帯域幅は、Web ノード、データベース、キャッシュ/セッションサーバ、その他のサービス間でのデータ交換に関する主要な要件の 1 つです。

Adobeコマースはキャッシュを効果的に活用して高パフォーマンスを実現するので、システムは Redis などのキャッシュサーバーとデータを積極的に交換できます。 Redis がリモートサーバー上にある場合は、読み取り/書き込み操作のボトルネックを防ぐために、Web ノードとキャッシュサーバー間に十分なネットワークチャネルを提供する必要があります。

### オペレーティングシステム (OS)

オペレーティングシステムの設定と最適化は、他の高負荷 WebAdobeと比較して、Web アプリケーションコマースに似ています。 サーバーが処理する同時接続の数が増えると、使用可能なソケットの数が完全に割り当てられる場合があります。

### Web ノードの CPU

1 つの CPU コアは、キャッシュを効果的に行わずに、約 2 ～ 4Adobe・コマース要求に対応できます。 すべての受信リクエストをキューに入れずに処理するために必要な Web ノード/コアの数を判断するには、次の式を使用します。

```
N[Cores] = (N [Expected Requests] / 2) + N [Expected Cron Processes])
```

### PHP-FPM 設定

これらの設定を最適化するかどうかは、様々なプロジェクトのパフォーマンステスト結果に依存します。

- **ByteCode** - PHP 7 のAdobe・コマースを最大限に高速化するには、モジュールを有効化し、正しく設 `opcache` 定する必要があります。

- **APCU**:PHP の APCu 拡張を有効にし、最大のパフォーマンスを得るために Composer を設定することをお勧めします。この拡張機能は、開いたファイルの場所をキャッシュします。これにより、ページ、Ajax 呼び出し、エンドポイントを含む、Adobeコマースサーバー呼び出しのパフォーマンスが向上します。

- **Realpath_cacheconfiguration** — 最適化を使用す `realpath_cache` ると、PHP プロセスは、ページを読み込むたびにパスを検索するのではなく、ファイルへのパスをキャッシュできます。

### Web サーバー

Web サーバーとして nginx を使用する場合は、わずかな再構成のみが必要です。 nginx Web サーバーは、Adobeコマース ([`nginx.conf.sample`](https://github.com/magento/magento2/blob/2.4/nginx.conf.sample)) のサンプル設定ファイルを使用して、より高いパフォーマンスを提供し、簡単に設定できます。

- TCP を使用した PHP-FPM の設定

- HTTP/2 および Gzip の有効化

- ワーカー接続の最適化

### データベース

各ストアと環境は異なるので、このドキュメントでは MySQL の詳細なチューニング手順は示しませんが、一般的な推奨事項をいくつか示すことができます。

Adobeコマースデータベース（およびその他のデータベース）は、データとインデックスの保存に使用できるメモリの量に依存します。 MySQL データのインデクションを効果的に活用するには、少なくとも、データベースに格納されているデータのサイズの半分に近いメモリを使用できる必要があります。

`innodb_buffer_pool_instances` 設定を最適化して、複数のスレッドが同じインスタンスにアクセスしようとする際の問題を回避します。 `max_connections` パラメータの値は、アプリケーションサーバーで設定された PHP スレッドの合計数と関連付ける必要があります。 `innodb-thread-concurrency` の最適な値を計算するには、次の式を使用します。

```
innodb-thread-concurrency = 2 * (NumCPUs+NumDisks)
```

### セッションのキャッシュ

Redis の別のインスタンスに対してセッションキャッシュを設定するのは、適切な候補です。 このキャッシュタイプのメモリ設定では、サイトの買い物かご放棄戦略と、セッションがキャッシュに残る期間を考慮する必要があります。

Redis には、最適なパフォーマンスを得るために、他のすべてのキャッシュをメモリに保持するのに十分なメモリが割り当てられている必要があります。 ブロック・キャッシュは、構成するメモリ量を決定する際の重要な要素です。 ブロックキャッシュは、サイトのページ数（SKU 数 x ストア表示数）に比べて増加します。

### ページキャッシュ

Vanrish を使用して、Commerce ストアの完全なページキャッシュをAdobeすることを強くお勧めします。 `PageCache` モジュールはコードベース内にまだ存在しますが、開発目的でのみ使用してください。

Wanish は、Web 層の前にある別のサーバーにインストールします。 受信する要求をすべて受け入れ、キャッシュされたページコピーを提供する必要があります。 Wanish がセキュリティで保護されたページで効果的に機能するように、SSL 終端プロキシを Wanish の前に配置できます。 Nginx はこの目的で使用できます。

Vanrish のフルページキャッシュメモリの無効化は有効ですが、Vanrish に十分なメモリを割り当てて、最も人気のあるページをメモリに保持することをお勧めします。

### メッセージキュー

Message Queue Framework（MQF；メッセージキューフレームワーク）は、モジュールがキューにメッセージを発行できるシステムです。 また、非同期でメッセージを受信するコンシューマーも定義します。 Adobeコマースは、メッセージングブローカーとして RabbitMQ をサポートし、メッセージの送受信に拡張性の高いプラットフォームを提供します。

### パフォーマンスのテストと監視

各実稼動リリース前のパフォーマンステストでは、e コマースプラットフォームの機能を推定することを常にお勧めします。 起動後も監視を続け、ピーク時の処理に対応する拡張性とバックアップ計画を策定します。

>[!NOTE]
>
> クラウドインフラストラクチャ上のAdobeコマースでは、DNS ルックアップを除き、上記のインフラストラクチャとアーキテクチャの最適化がすべて既に適用されています。スコープ外です。

### 検索

ElasticsearchはAdobeコマースバージョン 2.4 以降で必要ですが、2.4 より前のバージョンで有効にすることもお勧めします。

## オペレーティングモデル

前述の一般的なインフラストラクチャ最適化の推奨事項に加え、特定のビジネスモードや規模に対するパフォーマンスを向上させるアプローチもあります。 各シナリオが異なるので、このドキュメントでは、すべてのシナリオに対して詳細な調整手順は提供しませんが、参照用にいくつかの高度なオプションを提供できます。

### ヘッドレスアーキテクチャ

[ ヘッドレス ](../../architecture/headless/adobe-commerce.md) と異なるオプションの詳細を説明する別のセクションがあります。 要約すると、ストアフロントレイヤーがプラットフォーム自体から切り離されます。 同じバックエンドですが、Adobeコマースはリクエストを直接処理する代わりに、GraphQL API を介したカスタムストアフロントのみをサポートします。

### Adobeコマースの更新を維持

Adobeコマースでは、最新バージョンを実行すると、常にパフォーマンスが向上します。 新しいAdobeがリリースされるたびに、Adobeコマースを最新の状態に保つことができない場合でも、パフォーマンスが大幅に最適化される場合は、引き続きアップグレードすることをお勧めします。

例えば、2020 年にAdobeは Redis 層の最適化をリリースし、非効率性の多く、接続の問題、Redis とAdobe・コマース間の不要なデータ転送を修正しました。 2.3 と 2.4 の間の全体的なパフォーマンスは昼夜を問わず、Redis の最適化のため、買い物かご、チェックアウト、同時ユーザー数が大幅に改善されました。

### データモデルの最適化

データには、不良なデータモデル、正しく構造化されていないデータ、インデックスが欠落しているデータなど、多くの問題が発生します。

少数の接続をテストしている場合は問題なく見えますが、実際のトラフィックがヒットした場合は実稼動環境で確認され、その場合は低速になります。 システムインテグレーターは、データモデル（特に製品属性）の設計方法、不要な属性の追加を避け、ビジネスロジックに影響を与える必須属性（価格設定、在庫の可用性、検索など）を保持する方法を知っていることが非常に重要です。

ビジネスロジックに影響を与えず、ストアフロントにまだ存在する必要がある属性の場合は、属性をいくつかの属性（JSON 形式など）に組み合わせます。

プラットフォームのパフォーマンスを最適化するために、PIM や ERP から取得したデータや属性からストアフロントでビジネスロジックが必要でない場合は、その属性をAdobeコマースに追加する必要はありません。

### 拡張性の設計

これは、キャンペーンを実行し、ピーク時に頻繁に直面する企業にとって重要です。 アーキテクチャとアプリケーションの設計を容易に拡張できるように、ピーク時のリソースを増やし、その後のリソースを削減できます。

---
title: 自己ホスト型のAdobe Commerce災害復旧
description: 自己ホスト型のディザスタリカバリのアイデアと概念、および考慮すべきベストプラクティスについて説明します。
landing-page-description: 災害復旧の概念と、Adobe Commerceを独自にホストする際に考慮すべき事項について説明します。
short-description: Adobe Commerceを自分でホストするための戦略と災害復旧の概念について説明します。
kt: 11420
doc-type: tutorial
audience: all
last-substantial-update: 2023-04-13T00:00:00Z
source-git-commit: 6e361169889c8fe1c176d3a3283d52699dfa3b85
workflow-type: tm+mt
source-wordcount: '1771'
ht-degree: 0%

---


# 自己ホスト型のAdobe Commerce災害復旧のアイデア

この記事の災害復旧には、失敗したデプロイメントが含まれます。 プロセス全体が同じではない場合もありますが、同じ原則が適用されます。 災害は、本番環境の導入が失敗し、サーバが応答しなくなり、悪用の検出など、多くのシナリオが原因で発生する可能性があります。 障害が発生したデプロイメントのリカバリ・プロセスに必要な手順が 2 つだけの場合は、エクスプロイトからのリカバリがはるかに困難になる場合があります。 環境の複雑さ、ホスティングのバリエーション、その他の複雑さにより、この記事ではアイデアや概念を提供しますが、自分で調査を続ける必要があります。 これにより、ビジネスニーズに合った戦略を確実に設計できます。

## 頻繁にリカバリ・プロセスを実行

練習、練習、練習。 災害復旧リストに最初に慣行が表示される理由があります。 リカバリ・プランの設定は簡単ですが、実行しないでください。 十分な練習を行わないと、エラーが発生し、手順が不足し、実際のリカバリに時間がかかる可能性が高くなります。 プラクティスの回復のサイクルは、お客様とビジネスパートナーによって異なります。 回復プロセスを年次イベントにすることは十分に良いことでしょうが、社内の意思決定者との深い会話には、いくつかの主要なトピックを含める必要があります。 これらのトピックは、練習が重要であり、期待されるべき理由を理解するのに役立ちます。 以下に、会話を始めるのに役立つトピックをいくつか示します。

* 練習すると、実際にイベントが発生した場合の実際のダウンタイムが短縮されます。 1 年に 1 時間、ドライランの練習がサイトを停止する場合、実際のイベントの実際のダウンタイムを数時間短縮する可能性があります。 サイトのリカバリに 8 時間以上かかることは珍しくありません。 このイベントを頻繁に実行すると、各フェーズの所要時間を短縮でき、迅速なリカバリが可能になります。
* これらのプラクティスの実行に対する予定されたダウンタイムは、サーバーパッチ、インベントリ調整、または通常のスケジュールで実行する必要があるその他のすべてと同時に発生する可能性があります。
* 同じシナリオではなく、異なるシナリオを実行します。 時々、前の日から完全な回復を行う時間を取ります。 これには、データベースのアーカイブされたコピーの検索と使用、日付に合わせてコードをロールバックするなどが含まれます。 失敗したデプロイメントからの回復が簡単になり、前のコミットにロールバックするだけで済みます。
* リカバリ・プロセスが実際に動作することを確認し、アーカイブ・データベースが破損する場合があります。 これにより、すべての情報を確実に復元し、機能します。 古い DB の検索と復元には時間がかかります。プロセスのこの部分の時間がわかっているはずです。
* 設定に加えられた変更がすべて文書化されていることを検証します。 これにより、古いデータベースからのリカバリが確実に機能するように、新しい構成の変更がすべて機能する必要があります。 例えば、API キーが過去数日間に支払い処理者に変更された場合などです。 適切な変更管理プロセスを実行すると、これらの主要な更新を見つけて、プロセスが計画どおりに進みます。

## DB バックアップ

データベースのバックアップは非常に正常である必要があります。 時間別、日別、週別、月別のスナップショットを持つことは珍しくありません。 バックアップは、最終的に長期ストレージに移行する必要があります。 この長期ストレージは、ビジネスチームまたはテクノロジーチームが十分な時間を過ぎたと判断した場合に、迅速な回復が必要なくなった可能性があります。 長期ストレージからのリカバリは、リカバリ・プロセスに時間がかかるので、リカバリ・プロセスを実行するタイミングを決定する際には注意が必要です。 データベースのバックアップは、人間の操作に依存せず、自動化する必要があります。 これにより、安全で予測可能なリカバリ・プロセスを提供するのに十分な量のリソースを確保できます。 これは、法医学的なアクティビティでも役立ちますが、必要に応じて、そのアクティビティが実行可能で信頼性が高くなります。 不正利用が検出された後、またはクレジットカード詐欺行為がいつ発生したか、あるいはウェブサイトに誰かが参加したときの診断を試みる際に、法医学的な調査の必要性が見つかる場合があります。 これらのバックアップの使用方法に制限はありませんが、バックアップの頻度が高いのは、実際に必要な場合に備えた節約です。

データ保持ポリシーの例を次に示します。

* 8 時間ごと。 バックアップに容易にアクセスできるようにする必要があります。
* 過去 7 日間の毎日のバックアップと、容易にアクセスできる状態。 これらのコピーは、オフサイトに移動するための候補となる可能性があります。
* 過去 4 週間の週次バックアップでは、オフサイトへの移行を検討しています。
* 過去 3 か月間の月次バックアップはオフサイトに移動しました。
* 古いバックアップは、オフサイトの長期ストレージに移動されます。

## コードとしてのインフラストラクチャ

この方法論は、プロジェクトのパーツやインフラストラクチャ全体を再構築するためのツールとコードを用意していることを意味します。 これは、サーバーで問題が発生した場合に必要になる場合があり、使用から外す必要があります。 新しいサーバを迅速にオンラインにし、コードをデプロイし、PHP、Nginx、Apache の設定を行うなど、自動的にダウンタイムを短縮できます。 ランブック内のドキュメント化されたステップでも、設定が容易で、ステップを実行するのにはるかに時間がかかります。 また、ストレスが発生して応答しないサイトをオンラインに戻す際に発生する可能性のあるヒューマンエラーについても考慮します。

## セカンダリデータベース

セカンダリデータベースの使用は、いくつかの理由で役立つ場合があります。以下に例を示します。

* プライマリドライブに障害が発生した場合のウォームスタンバイ
* アプリケーションからの準備完了要求を許可
* mysqldump が発生し、データベースをロックせずに通常のトランザクションを実行できるようにします。
* Web サイトで顧客の要求に応じて情報を取り扱う機能を低下させることなく、外部データソースからデータにアクセスできるようにします。

セカンダリデータベースは、 `warm standby`. これは、プライマリ・データベース障害からのリカバリ方法を検討している場合に発生する可能性があります。 セカンダリデータベースをプライマリに昇格する方が、新しく作成した Mysql インスタンスにデータベースを再構築して復元するよりも、複雑さが低くなります。 これにより、リカバリオペレーション中の実際のダウンタイムが短縮されます。

一部の要求をセカンダリ・データベースに転送する機会があります。 この方法を使用する場合は、セカンダリ・データベースを読み取り専用にすることを推奨します。 Adobe Commerceアプリケーションでこのセカンダリデータベースを読み取り操作に使用できるようにすると、読み取りリクエストの一部を取り出し、セカンダリデータベースの応答を可能にすることで役立ちます。 ただし、この変更はすべてのリクエストの 30～50%を占めますが、プライマリデータベースから負荷を取り除くことができる場合は、勝利となります。

## ロールバックを含むデプロイメントプランを作成する

すべてのデプロイメントには、ロールバック計画を含める必要があります。 はい、すべての導入。 それを計画している場合、驚くことはなく、悪いイベントに備えています。 最も単純なコードの更新が、何らかの理由で大幅に失敗する場合があります。

データベース内のスキーマ変更を実行するための、小さくてシンプルなプルリクエストをコミットしたチームのこの真のストーリーを考えてみましょう。 1 分から 5 分、10 分の順に展開し、チームの不安が増しました。 この時点まで検証および検討に失敗したのは、ステージングデータベースと比較して、実稼動データベースからの相違です。 一般的に、実稼動環境のコピーを使用してステージング環境を更新する際に、すべての顧客データを削除する方法がありました。 そのため、これまでのすべてのテストと QA がデプロイメントを反映していたので、完了までに数分かかる必要がありました。 実際には、2,000 万人を超える顧客がいて、この小規模なスキーマの変更は完了までに非常に長い時間を要していました。 これが実際にどのくらいの時間がかかるかはわからなかったので、mysql プロセスを終了し、デプロイメントをロールバックする必要がありました。

デプロイメントのロールバックプロセスの準備には、全体的なプロセスが似ているので、数分かかります。 ただし、Git リポジトリのHEADをリセットして戻すコミットの内容を正確に文書化するには、時間をかける必要があります。 使用する DB スナップショットを正確に記述し、常に同じ場所にある場合は、現在の DB スナップショットをどこで見つけるかを記述する必要があります。 デプロイメントのステータスについて議論する必要がある時期と、それが自動的に有効になる時期を定義した。 たとえば、導入に 15 分以上かかる場合は、プロジェクトマネージャーや他の持ち主に、継続する必要があるかどうかを尋ねます。 ただし、プロジェクトマネージャーおよびアーキテクトがプロジェクトに迷っているかどうかに関係なく、プロセスが 45 分かかる場合は、ロールバックプロセスを自動的に実行し、すべての関係者に通知します。

プロセス全体および各段階に複数の担当者が関与していることを確認します。 ミッドレベルの開発者がデプロイメントプロセスを確認し、ファイルのロールバック手順と場所を確認することは、ファイルを参加させる優れた方法です。 最終的には、プロセス全体を理解できるように手順を実行することが、長期的な成功の鍵となります。 すべてのユーザーがデプロイメントを停止する権限を持っていることを確認します。 チームにこの量の発言を与えることは、力を与え、報いを与えます。 若手の開発者が、何かが失われていると本当に感じた場合、彼らは声を上げ、彼らの注意を聞かせる必要があります。 建築家やプロジェクトマネージャーが自分の恐怖を確認したり、軽減したりできるようにします。 プロジェクトを探し、完全なデプロイメントを記録し続けている強力なチームを持つことが重要です。

## ドメイン名管理、DMS、SSL、WAF へのアクセスを検証

ドメイン名の有効期限が切れるので、DNS レコードが誤って変更される可能性があり、SSL 証明書が期限切れになるなど、さらに多くのことが考えられます。ログインして、接続が頻繁に発生することを確認できることを確認します。 この簡単なチェックを四半期ごとに行うことで、特に緊急時に物がどこにあるかを正確に把握できます。 DNS がAmazonで管理されていることを確認するためだけに、レジストラで DNS が管理されていると仮定しないでください。 これらのレコードは頻繁に使用されないので、どこにあるか忘れる可能性が高いです。 ユーザー名とパスワードだけに関する文書を信頼しないでください。 各ユーザーにログインし、探している設定が実際にそこで管理されていることを確認します。 多くの場合、管理の売り上げや企業の買収の際に変化し、1 人だけが何が起こったかを知っています。なぜなら、彼らは更新を行った人なのです。 ユーザーは、共有単語のドキュメントの場所、ユーザー名、パスワードを使用していることを認識していませんでした。 お客様とお客様の組織にとって理にかなうチェックプロセスを見つけますが、3～6 ヶ月ごとにチェックを行うのが良い出発点です。

{{$include /help/_includes/hosting-related-links.md}}
